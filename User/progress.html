<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress - OptiLife</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="usercss/home.css">

    <style>

    :root {
        /* Base Theme Colors (Keep consistent) */
        --bg-color: #000;
        --snd-bf-color: #111;
        --text-color: #ffffff; /* Default light text */
        --main-color: #FFD700; /* Primary Gold */
        --color-black: #0a0a0a;
        --color-dark-gray: #1a1a1a; /* Main dark background for cards */
        --color-gold-light: #f0c44c;
        --color-text-muted: #aaaaaa; /* Muted light text */
        --border-color-light: #333; /* Dark border */
        --header-height-desktop: 100px;
        --header-height-mobile: 80px;
        --font-primary: 'Poppins', sans-serif;

        /* Progress Page Specific Theme Variables */
        --card-bg-setgoals: var(--color-dark-gray); /* CHANGED: Dark background for cards */
        --text-dark-setgoals: var(--text-color); /* CHANGED: Light text for dark cards */
        --text-muted-setgoals: var(--color-text-muted); /* Use muted light text */
        --border-color-light-setgoals: var(--border-color-light); /* CHANGED: Darker border */
        --primary-color-darkest-setgoals: var(--main-color); /* CHANGED: Use main gold for emphasis */
        --grid-gap: 1.5rem;
        --content-padding: 1.5rem;
        --button-primary-bg: var(--main-color); /* Keep Gold */
        --button-primary-text: var(--color-black); /* Keep Black text */
        --button-primary-hover-bg: var(--color-gold-light); /* Lighter gold hover */
        --button-secondary-bg: #555; /* CHANGED: Darker secondary button */
        --button-secondary-text: var(--text-color); /* Light text */
        --button-secondary-hover-bg: #666; /* Slightly lighter dark hover */
        --modal-overlay-bg: rgba(0, 0, 0, 0.7);
        --stat-card-icon-color: var(--main-color); /* CHANGED: Use main gold */
        --stat-card-value-color: var(--text-color); /* CHANGED: Light text */
        --stat-card-sub-increase: #4CAF50; /* Keep green */
        --stat-card-sub-decrease: #f44336; /* Keep red */
        --table-header-bg: #252525; /* CHANGED: Darker header bg */
        --table-row-even-bg: #222; /* CHANGED: Slightly different dark for stripes */
        --table-row-hover-bg: #303030; /* CHANGED: Darker hover */
        --table-border-color: var(--border-color-light-setgoals); /* Use dark border var */
        --chart-title-color: var(--text-color); /* CHANGED: Light text */
        --input-bg-setgoals: #252525; /* CHANGED: Dark input bg */
        --input-focus-shadow: rgba(255, 215, 0, 0.3); /* Gold focus glow */
        --modal-bg-setgoals: var(--color-dark-gray); /* CHANGED: Dark modal background */
        --modal-text-setgoals: var(--text-color); /* CHANGED: Light modal text */
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      text-decoration: none;
      list-style: none;
      border: none;
      outline: none;
    }

    html {
        font-size: 62.5%;
        overflow-x: hidden;
        scroll-behavior: smooth;
    }

    body { /* Ensure body background is dark */
      background-color: var(--bg-color);
      color: var(--text-color); /* Default text color */
      font-family: var(--font-primary);
      line-height: 1.6;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    img {
        max-width: 100%;
        height: auto;
        display: block;
    }

    main.content-grid {
        padding-top: calc(var(--header-height-desktop, 100px) + 2rem); /* Ensure enough space */
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: var(--grid-gap);
        padding-left: var(--content-padding);
        padding-right: var(--content-padding);
        padding-bottom: var(--content-padding);
        color: var(--text-dark-setgoals); /* Use light text variable */
    }

    .card {
        background-color: var(--card-bg-setgoals); /* Use dark bg variable */
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3); /* Darker shadow */
        border: 1px solid var(--border-color-light-setgoals); /* Use dark border variable */
        color: var(--text-dark-setgoals); /* Use light text variable */
    }

    .calendar-widget {
         border: 2px solid var(--primary-color-darkest-setgoals); /* Keep gold border */
    }

    .calendar-widget h2,
    .calendar-widget .input-block label,
    .nutrient-header span:first-child,
    #log-meal-modal h3,
    #log-meal-modal .logged-items-display h4 {
         color: var(--primary-color-darkest-setgoals) !important; /* Keep Gold for these specific labels */
    }

    .calendar-header {
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 1rem; font-weight: 500;
        color: var(--text-dark-setgoals); /* Light text */
    }
    .cal-nav {
        border: 1px solid var(--border-color-light-setgoals); /* Dark border */
        color: var(--text-muted-setgoals); /* Muted light text */
        padding: 3px 8px; border-radius: 4px; cursor: pointer; background: none;
    }
    .cal-nav:hover {
        color: var(--primary-color-darkest-setgoals); /* Gold hover text */
        border-color: var(--primary-color-darkest-setgoals); /* Gold hover border */
    }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; margin-bottom: 1.5rem; }
    .day-name {
        font-weight: 600; font-size: 0.8rem;
        color: var(--text-muted-setgoals); /* Muted light text */
        text-transform: uppercase;
    }
    .date-cell { display: flex; justify-content: center; align-items: center; aspect-ratio: 1 / 1; }
    .date-cell button {
        width: 100%; height: 100%; border-radius: 50%; border: 2px solid transparent; background-color: transparent;
        color: var(--text-dark-setgoals); /* Light text */
        cursor: pointer; font-size: 0.9rem; transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease; display: flex; align-items: center; justify-content: center; padding: 0;
    }
    .date-cell button:hover:not(.selected) {
        background-color: #333; /* Darker hover bg */
        border-color: var(--border-color-light-setgoals);
    }
    .date-cell button.selected {
        background-color: var(--main-color); /* Gold selected bg */
        color: var(--color-black); /* Black selected text */
        font-weight: bold;
        border-color: var(--color-gold-light); /* Lighter gold border */
    }
    .date-cell.empty { visibility: hidden; }

    .calendar-widget .input-block { margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color-light-setgoals); }
    .calendar-widget .input-block:last-child { border-bottom: none; padding-bottom: 0; margin-bottom: 0; }
    /* Label color already set to gold via specific rule above */
    .calendar-widget .info-input {
        background-color: var(--input-bg-setgoals); /* Dark input bg */
        border: 1px solid var(--border-color-light-setgoals); /* Dark border */
        color: var(--text-dark-setgoals); /* Light text */
        font-size: 0.95rem; padding: 8px 10px; width: 100%; border-radius: 4px;
    }
    .calendar-widget .info-input:focus {
        outline: none; border-color: var(--main-color); /* Gold focus border */
        box-shadow: 0 0 0 2px var(--input-focus-shadow); /* Gold focus glow */
    }
    .calendar-widget .goals-list {
        list-style: disc; padding-left: 20px; margin: 5px 0 0 0; font-size: 0.9rem;
        color: var(--text-muted-setgoals); /* Muted light text */
    }
    .calendar-widget .goals-list li { margin-bottom: 3px; }

    /* --- Modal Theming --- */
    #logoutConfirmationModal .modal-content {
        background-color: var(--modal-bg-setgoals); /* CHANGED: Dark modal bg */
        color: var(--modal-text-setgoals); /* CHANGED: Light modal text */
        max-width: 400px; padding: 30px 35px;
        border-color: var(--border-color-light); /* Dark border */
    }
    #logoutConfirmationModal #logoutModalMessage {
        color: var(--modal-text-setgoals); /* Light text */
        font-size: 1.5rem; margin-top: 10px; margin-bottom: 30px; line-height: 1.5; text-align: center;
    }
    #logoutConfirmationModal .close-button {
        color: var(--text-muted-setgoals); /* Muted light text */
    }
    #logoutConfirmationModal .close-button:hover {
        color: var(--text-color); /* Brighter light text */
    }
    #logoutConfirmationModal .modal-actions button { font-weight: 600; font-size: 0.95rem; margin: 0 8px; min-width: 100px; }
    #logoutConfirmationModal #cancelLogoutButton {
        background-color: var(--button-secondary-bg); /* Dark secondary bg */
        color: var(--button-secondary-text); /* Light text */
        border-color: #444; /* Slightly darker border */
    }
    #logoutConfirmationModal #cancelLogoutButton:hover {
        background-color: var(--button-secondary-hover-bg); /* Darker hover */
    }
    #logoutConfirmationModal #okLogoutButton {
        background-color: var(--button-primary-bg); /* Gold primary bg */
        color: var(--button-primary-text); /* Black text */
        border-color: var(--main-color); /* Match bg border */
        margin-left: 15px; /* Adjusted margin */
    }
    #logoutConfirmationModal #okLogoutButton:hover { /* Keep Gold hover */
        background-color: transparent;
        color: var(--main-color);
        box-shadow: 0 0 1.6rem var(--main-color);
        transform: translateY(-2px);
        border-color: var(--main-color);
    }


    .main-tab-content {
        border: 2px solid var(--primary-color-darkest-setgoals); /* Keep gold border */
        border-radius: 8px;
        background-color: var(--card-bg-setgoals); /* Use dark card bg */
        color: var(--text-dark-setgoals); /* Light text */
        min-width: 0;
        overflow: hidden;
    }

    .tab-content {
         display: none;
    }
    .tab-content.active {
         display: block;
         animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }


    .content-placeholder {
        padding: 1.5rem; background-color: transparent; /* Ensure transparent */
        border-radius: 0; border: none; min-height: 300px; box-shadow: none;
    }
    .content-placeholder h1 {
        font-size: 1.8rem; margin-bottom: 1.5rem; font-weight: 600;
        color: var(--text-dark-setgoals); /* Light text */
        text-align: left; padding-bottom: 0.8rem;
        border-bottom: 2px solid var(--main-color); /* Gold border */
        display: inline-block;
    }

    .main-content-tabs {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 2rem;
        padding: 1rem 1.5rem;
        border-bottom: 2px solid var(--border-color-light-setgoals); /* Dark border */
        gap: 1rem;
    }

    button.main-tab-button {
        display: inline-flex; align-items: center; gap: 0.7rem;
        padding: 0.8rem 1.5rem; font-size: 1.5rem; font-weight: 500;
        color: var(--text-muted-setgoals); /* Muted light default text */
        background-color: #333; /* Darker default bg */
        border: 1px solid #444; /* Darker border */
        border-radius: 6px;
        cursor: pointer; transition: all 0.3s ease;
        font-family: inherit;
    }
    button.main-tab-button i { font-size: 1.8rem; line-height: 1; }
    button.main-tab-button:hover {
        background-color: #444; /* Slightly lighter dark hover */
        border-color: #555;
        color: var(--text-color); /* Brighter text on hover */
    }
    button.main-tab-button.active {
        background-color: var(--main-color); /* Gold active bg */
        color: var(--color-black); /* Black active text */
        font-weight: 600; border-color: var(--color-gold-light); /* Lighter gold border */
        box-shadow: 0 2px 5px rgba(218, 165, 32, 0.2);
    }


    #tabs-1 .content-placeholder h1::before { content: " "; } /* Removed unnecessary content */
    #tabs-1 .workout-type-block { border-bottom: none; padding-bottom: 0; margin-bottom: 1rem;}
    #tabs-1 .workout-type {
        font-size: 1.1rem; font-weight: 500;
        color: var(--text-dark-setgoals); /* Light text */
        background-color: var(--input-bg-setgoals); /* Dark bg */
        padding: 10px 15px; border-radius: 4px;
        border: 1px solid var(--border-color-light-setgoals); /* Dark border */
    }
    .workout-table-container { overflow-x: auto; margin-top: 1rem; }
    .workout-table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
    .workout-table th, .workout-table td {
        padding: 12px 15px; text-align: left;
        border: 1px solid var(--table-border-color); /* Dark border */
        color: var(--text-dark-setgoals); /* Light text for cells */
    }
    .workout-table th {
        background-color: var(--table-header-bg); /* Dark header bg */
        font-weight: 600;
        color: var(--primary-color-darkest-setgoals); /* Gold header text */
        text-transform: uppercase; font-size: 0.85rem;
    }
    .workout-table tbody tr:nth-child(even) {
        background-color: var(--table-row-even-bg); /* Dark stripe bg */
    }
    .workout-table tbody tr:hover {
        background-color: var(--table-row-hover-bg); /* Dark hover bg */
    }
    .workout-table .notes-cell {
        font-style: italic;
        color: var(--text-muted-setgoals); /* Muted light text */
        font-size: 0.9em;
    }


    #tabs-2 .content-placeholder h1::before { content: " "; }
    .card-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: var(--grid-gap); margin-bottom: 2rem; }
    .stat-card {
        text-align: center; padding: 1.5rem 1rem;
        background-color: var(--snd-bf-color); /* Use secondary dark bg */
        border-color: var(--border-color-light-setgoals); /* Ensure dark border */
    }
    .stat-card .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; border-bottom: 1px solid var(--border-color-light-setgoals); padding-bottom: 0.8rem;}
    .stat-card .card-header h3 { margin: 0; font-size: 1.1rem; color: var(--text-dark-setgoals); font-weight: 600;}
    .stat-card .card-header i { font-size: 1.8rem; color: var(--stat-card-icon-color); /* Gold icon */ }
    .stat-card .card-body .value { font-size: 2rem; font-weight: 600; color: var(--stat-card-value-color); /* Light text */ margin: 0 0 5px 0; line-height: 1.2; }
    .stat-card .card-body .unit { font-size: 0.9rem; font-weight: 400; color: var(--text-muted-setgoals); margin-left: 3px; }
    .stat-card .card-body .sub-value { margin: 0 0 10px 0; font-size: 0.9rem; font-weight: 500; }
    .stat-card .card-body .sub-value.increase { color: var(--stat-card-sub-increase); }
    .stat-card .card-body .sub-value.decrease { color: var(--stat-card-sub-decrease); }
    .stat-card .card-body .description { font-size: 0.85rem; color: var(--text-muted-setgoals); margin: 0; }

    .graph-controls {
        display: flex; flex-wrap: wrap; gap: 1.5rem; align-items: center;
        background-color: var(--input-bg-setgoals); /* Dark bg */
        padding: 1rem; border-radius: 5px;
        border: 1px solid var(--border-color-light-setgoals); margin-bottom: 2rem;
    }
    .control-group { display: flex; align-items: center; gap: 0.5rem; }
    .control-group label {
        font-weight: 500;
        color: var(--text-dark-setgoals); /* Light text */
        font-size: 0.95rem;
    }
    .control-group i { font-size: 1.3rem; color: var(--primary-color-darkest-setgoals); /* Gold icon */ }
    .control-group select {
        padding: 8px 12px; border: 1px solid var(--border-color-light-setgoals); border-radius: 4px;
        background-color: var(--snd-bf-color); /* Dark select bg */
        color: var(--text-dark-setgoals); /* Light text */
        font-size: 0.9rem; cursor: pointer;
    }
    .control-group select:focus {
        outline: none; border-color: var(--main-color); /* Gold focus border */
        box-shadow: 0 0 0 2px var(--input-focus-shadow); /* Gold focus glow */
    }
    .graph-placeholder {
        background-color: var(--snd-bf-color); /* Dark graph bg */
        padding: 1.5rem; border-radius: 5px;
        border: 1px solid var(--border-color-light-setgoals);
    }
    .chart-area h3 { text-align: center; margin-bottom: 1.5rem; font-size: 1.3rem; color: var(--chart-title-color); font-weight: 600;}
    .canvas-wrapper { position: relative; height: 300px; width: 100%; }
    /* Chart.js automatically handles canvas background, but ensure text/ticks are visible */
    /* Chart.js options in JS will handle tick colors */


    #tabs-3 .content-placeholder h1::before { content: " "; }
    .tabs { display: flex; justify-content: center; flex-wrap: wrap; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color-light-setgoals); padding-bottom: 0.5rem; gap: 10px; }
    .tabs .tab-button {
        color: var(--text-muted-setgoals); /* Muted light default text */
        font-size: 0.95rem; padding: 0.6rem 1rem; border-radius: 4px; transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease; white-space: nowrap;
        border: 2px solid transparent; background-color: transparent; cursor: pointer; font-weight: 500;
    }
    .tab-button:hover {
        color: var(--text-color); /* Brighter text */
        background-color: #333; /* Darker bg */
    }
    .tab-button.active {
        background-color: var(--main-color); /* Gold active bg */
        color: var(--color-black); /* Black active text */
        font-weight: 600; border-color: var(--color-gold-light); /* Lighter gold border */
    }

    .nutrition-tab-content { display: none; padding-top: 1rem; animation: fadeIn 0.5s ease-in-out; }
    .nutrition-tab-content.active { display: block; }
    .nutrition-tab-content h2 {
        font-size: 1.3rem; margin-bottom: 1.5rem; font-weight: 600;
        color: var(--text-muted-setgoals); /* Muted light text */
        text-align: center;
    }
    .nutrition-details-full { max-width: 700px; margin: 0 auto; }
    .chart-placeholder-container { max-width: 300px; margin: 0 auto 1.5rem auto; position: relative;}

    .calories-breakdown { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; max-width: 700px; margin-left: auto; margin-right: auto; }
    .meal-item {
        display: flex; align-items: center; gap: 10px; padding: 10px 12px;
        background-color: var(--snd-bf-color); /* Secondary dark bg */
        border-radius: 4px; border: 1px solid var(--border-color-light-setgoals); /* Dark border */
    }
    .meal-info { font-size: 0.9rem; flex-grow: 1; }
    .meal-info div:first-child { font-weight: 500; color: var(--text-dark-setgoals); /* Light text */ }
    .meal-info div:last-child { color: var(--text-muted-setgoals); font-size: 0.85em; }

    /* Add food button needs adjustment if kept */
    .add-food-btn {
        background-color: #444; color: var(--text-muted-setgoals); margin-left: auto; border: 1px solid #555; padding: 5px 8px; font-size: 0.9rem; line-height: 1; border-radius: 50%; width: 28px; height: 28px; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0; cursor: pointer;
    }
    .add-food-btn:hover { background-color: #555; color: var(--text-color); border-color: #666; }

    .calorie-summary {
        display: flex; flex-direction: column; gap: 10px;
        color: var(--text-muted-setgoals); font-size: 1em; margin-top: 1rem; padding-top: 1rem;
        border-top: 1px solid var(--border-color-light-setgoals); max-width: 400px; margin-left: auto; margin-right: auto;
    }
    .summary-item { display: flex; justify-content: space-between; align-items: center; }
    .summary-item span:last-child { font-weight: 600; color: var(--text-dark-setgoals); /* Light text */ }
    .summary-item span.exercise { color: #f44336; } /* Keep red */
    .summary-item.goal span:last-child { color: var(--primary-color-darkest-setgoals); /* Gold text */ font-size: 1.1em; font-weight: bold; }
    .summary-divider { border: none; height: 1px; background-color: var(--border-color-light-setgoals); margin: 5px 0; }
    .editable {
        cursor: pointer; border-bottom: 1px dashed var(--primary-color-darkest-setgoals); padding-bottom: 1px; transition: background-color 0.2s ease; display: inline-block;
        color: var(--text-dark-setgoals); /* Ensure editable text is light */
    }
    .editable:hover { background-color: rgba(255, 215, 0, 0.1); }

    .nutrient-header { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 10px; padding: 0 10px 10px 10px; font-size: 0.85em; font-weight: 600; text-align: right; border-bottom: 1px solid var(--border-color-light-setgoals); margin-bottom: 10px; text-transform: uppercase; color: var(--text-muted-setgoals); } /* Muted text for header */
    .nutrient-list { list-style: none; max-height: 400px; overflow-y: auto; padding-right: 5px; }
    .nutrient-list li { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 10px; padding: 10px; border-bottom: 1px solid #282828; align-items: center; font-size: 0.95em; }
    .nutrient-list li:last-child { border-bottom: none; }
    .nutrient-list li span:first-child { font-weight: 500; text-align: left; color: var(--text-dark-setgoals); /* Light text */ }
    .nutrient-list li span:not(:first-child) { text-align: right; color: var(--text-muted-setgoals); /* Muted light text */ }

    .macros-legend { display: flex; flex-direction: column; gap: 1rem; max-width: 500px; margin: 1.5rem auto 0 auto; }
    .legend-item {
        display: grid; grid-template-columns: auto 1fr auto auto; align-items: center; gap: 10px; font-size: 0.95em;
        color: var(--text-dark-setgoals); /* Light text */
        padding: 10px; background-color: var(--snd-bf-color); border-radius: 4px; border: 1px solid var(--border-color-light-setgoals);
    }
    .color-square { width: 14px; height: 14px; display: inline-block; border-radius: 3px; border: 1px solid rgba(255,255,255,0.1); } /* Lighter border for dark */
    .legend-item .percentage { font-weight: 500; text-align: right; }
    .legend-item .goal-percentage { color: var(--text-muted-setgoals); text-align: right; font-style: italic; font-size: 0.9em; }

    /* Responsive adjustments need to consider dark theme */
    @media (max-width: 1024px) {
        .navbar-right img.profile-pic {
            /* Inherits base styles */
        }
    }

    @media (max-width: 992px) {
         main.content-grid {
             grid-template-columns: 1fr;
             padding-top: calc(var(--header-height-mobile, 80px) + 1rem); /* Use correct mobile height */
        }
         .calendar-widget { order: -1; margin-bottom: var(--grid-gap); }
         .workout-table th, .workout-table td { padding: 10px 8px; font-size: 0.9rem;}
         .workout-table .notes-cell { font-size: 0.85em; }
    }
     @media (max-width: 767px) {
         main.content-grid {
             padding-top: calc(var(--header-height-mobile, 80px) - 10px + 1rem); /* Use correct mobile height */
         }
         .main-tab-button { font-size: 1.3rem; padding: 0.7rem 1.2rem; }
         .workout-table thead { display: none; }
         .workout-table, .workout-table tbody, .workout-table tr, .workout-table td { display: block; width: 100%; }
         .workout-table tr {
             margin-bottom: 15px; border: 1px solid var(--table-border-color); border-radius: 4px;
             background-color: var(--card-bg-setgoals); /* Use dark card bg for rows */
          }
         .workout-table td { text-align: right; padding-left: 50%; position: relative; border: none; border-bottom: 1px dotted var(--border-color-light-setgoals);}
         .workout-table td:last-child { border-bottom: none; }
         .workout-table td::before {
             content: attr(data-label); position: absolute; left: 10px; width: 45%; padding-right: 10px; white-space: nowrap; text-align: left; font-weight: bold;
             color: var(--primary-color-darkest-setgoals); /* Gold label */
             text-transform: uppercase; font-size: 0.8em;
         }
         .card-container { grid-template-columns: 1fr; }
         .graph-controls { flex-direction: column; align-items: stretch; gap: 1rem; }
         .control-group { justify-content: space-between; }
         .calories-breakdown { grid-template-columns: 1fr; }
         .nutrient-list li, .nutrient-header { font-size: 0.9em; grid-template-columns: 1.5fr 1fr 1fr 1fr; }
         .legend-item { grid-template-columns: auto 1fr auto auto; font-size: 0.9em; }

     }
     @media (max-width: 480px) {
          main.content-grid {
             padding-top: calc(var(--header-height-mobile, 80px) - 20px + 1rem); /* Use correct mobile height */
         }
          .main-tab-button { font-size: 1.1rem; padding: 0.6rem 1rem; gap: 0.5rem; }
          .main-tab-button i { font-size: 1.5rem; }
          .content-placeholder h1 { font-size: 1.4rem; }
          .workout-table td { padding-left: 40%;}
          .workout-table td::before { width: 35%; }
          .navbar-right img.profile-pic {
             width: 35px;
             height: 35px;
         }
         .navbar-right li {
             margin-bottom: 12px;
         }
     }

     /* Removed duplicate 320px breakpoint as 480px covers small screens */

</style>

</head>
<body>

    <header>
        <a href="home.html" class="logo"><img src="../images/logo.png" alt="OptiLife Logo"></a>
        <div class='bx bx-menu' id="menu-icon"></div>
        <ul class="navbar">
             <div class="navbar-left">
                 <li><a href="../User/home.html">Home</a></li>
                 <li><a href="../User/setGoals.html">Set Goals</a></li>
                 <li><a href="../User/progress.html" class="active">Track Progress</a></li>
                 <li><a href="../User/membership.html">Membership</a></li>
             </div>
             <div class="navbar-right">
                <li>
                    <img id="profilePicTrigger" src="../images/user_pic.jpg" alt="User Profile" class="profile-pic">
                </li>
                 <li>
                     <a href="signin.html" id="logout-link">Logout</a>
                 </li>
             </div>
        </ul>
    </header>

    <main class="content-grid">
         <aside class="calendar-widget card">
            <h2>Select Date</h2>
            <div class="calendar-header">
                <button class="cal-nav prev" aria-label="Previous month"><</button>
                <span class="current-month-year">April 2025</span>
                <button class="cal-nav next" aria-label="Next month">></button>
            </div>
            <div class="calendar-grid">
                <!-- Day names -->
                <div class="day-name">S</div> <div class="day-name">M</div> <div class="day-name">T</div>
                <div class="day-name">W</div> <div class="day-name">T</div> <div class="day-name">F</div>
                <div class="day-name">S</div>
                <!-- Dates (Example for April 2025) -->
                <div class="date-cell empty"></div> <div class="date-cell empty"></div>
                <div class="date-cell"><button>1</button></div> <div class="date-cell"><button>2</button></div>
                <div class="date-cell"><button>3</button></div> <div class="date-cell"><button>4</button></div>
                <div class="date-cell"><button>5</button></div> <div class="date-cell"><button>6</button></div>
                <div class="date-cell"><button>7</button></div> <div class="date-cell"><button>8</button></div>
                <div class="date-cell"><button>9</button></div> <div class="date-cell"><button>10</button></div>
                <div class="date-cell"><button>11</button></div> <div class="date-cell"><button>12</button></div>
                <div class="date-cell"><button>13</button></div> <div class="date-cell"><button>14</button></div>
                <div class="date-cell"><button class="selected" data-date="2025-04-15">15</button></div>
                <div class="date-cell"><button data-date="2025-04-16">16</button></div> <div class="date-cell"><button data-date="2025-04-17">17</button></div>
                <div class="date-cell"><button data-date="2025-04-18">18</button></div> <div class="date-cell"><button data-date="2025-04-19">19</button></div>
                <div class="date-cell"><button data-date="2025-04-20">20</button></div> <div class="date-cell"><button data-date="2025-04-21">21</button></div>
                <div class="date-cell"><button data-date="2025-04-22">22</button></div> <div class="date-cell"><button data-date="2025-04-23">23</button></div>
                <div class="date-cell"><button data-date="2025-04-24">24</button></div> <div class="date-cell"><button data-date="2025-04-25">25</button></div>
                <div class="date-cell"><button data-date="2025-04-26">26</button></div>
                <div class="date-cell"><button data-date="2025-04-27">27</button></div> <div class="date-cell"><button data-date="2025-04-28">28</button></div>
                <div class="date-cell"><button data-date="2025-04-29">29</button></div> <div class="date-cell"><button data-date="2025-04-30">30</button></div>
                <div class="date-cell empty"></div>
            </div>

            <div class="input-block">
                <label for="startDate">Start Date</label>
                <input type="date" id="startDate" name="startDate" class="info-input" value="2025-01-15">
            </div>

            <div class="input-block">
                <label>Goals</label>
                <ul class="goals-list">
                    <li>Improved overall fitness</li>
                    <li>Increased muscle strength</li>
                </ul>
             </div>
        </aside>

         <section class="main-tab-content card">
            <nav class="main-content-tabs">
                <button class="main-tab-button active" data-target="#tabs-1">
                    <i class='bx bx-list-ul'></i> Workout Log
                </button>
                <button class="main-tab-button" data-target="#tabs-2">
                    <i class='bx bx-line-chart'></i> Workout Status
                </button>
                 <button class="main-tab-button" data-target="#tabs-3">
                    <i class='bx bx-restaurant'></i> Nutrition Status
                </button>
            </nav>

            <div id="tabs-1" class="tab-content active">
                <div class="content-placeholder">
                    <h1>Workout Log Details:</h1>
                    <div class="input-block workout-type-block">
                        <p class="workout-type">Workout Type: Upper Body and Lower Body Split </p>
                    </div>
                    <div class="workout-table-container">
                        <table class="workout-table">
                            <thead>
                                <tr>
                                    <th scope="col">Exercise</th>
                                    <th scope="col">Sets</th>
                                    <th scope="col">Reps</th>
                                    <th scope="col">Weight</th>
                                    <th scope="col">Duration</th>
                                    <th scope="col">Notes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td data-label="Exercise">Squats</td>
                                    <td data-label="Sets">3</td>
                                    <td data-label="Reps">10-12</td>
                                    <td data-label="Weight">Bodyweight / 10 lbs</td>
                                    <td data-label="Duration">15 min</td>
                                    <td data-label="Notes" class="notes-cell">Focus on form</td>
                                </tr>
                                <tr>
                                    <td data-label="Exercise">Push-ups</td>
                                    <td data-label="Sets">3</td>
                                    <td data-label="Reps">AMRAP</td>
                                    <td data-label="Weight">Bodyweight</td>
                                    <td data-label="Duration">10 min</td>
                                    <td data-label="Notes" class="notes-cell">Modify on knees if needed</td>
                                </tr>
                                <tr>
                                    <td data-label="Exercise">Bent-over Rows</td>
                                    <td data-label="Sets">3</td>
                                    <td data-label="Reps">10-12</td>
                                    <td data-label="Weight">15 lbs dumbbells</td>
                                    <td data-label="Duration">15 min</td>
                                    <td data-label="Notes" class="notes-cell">Maintain straight back</td>
                                </tr>
                                <tr>
                                    <td data-label="Exercise">Overhead Press</td>
                                    <td data-label="Sets">3</td>
                                    <td data-label="Reps">10-12</td>
                                    <td data-label="Weight">15 lbs dumbbells</td>
                                    <td data-label="Duration">15 min</td>
                                    <td data-label="Notes" class="notes-cell">Controlled movement</td>
                                </tr>
                                <tr>
                                    <td data-label="Exercise">Walking Lunges</td>
                                    <td data-label="Sets">3</td>
                                    <td data-label="Reps">10 / leg</td>
                                    <td data-label="Weight">Bodyweight / 10 lbs</td>
                                    <td data-label="Duration">15 min</td>
                                    <td data-label="Notes" class="notes-cell">Good posture</td>
                                </tr>
                                <tr>
                                    <td data-label="Exercise">Plank</td>
                                    <td data-label="Sets">3</td>
                                    <td data-label="Reps">45 sec</td>
                                    <td data-label="Weight">Bodyweight</td>
                                    <td data-label="Duration">5 min</td>
                                    <td data-label="Notes" class="notes-cell">Engage core</td>
                                </tr>
                                <tr>
                                    <td data-label="Exercise">Calf Raises</td>
                                    <td data-label="Sets">3</td>
                                    <td data-label="Reps">15-20</td>
                                    <td data-label="Weight">Bodyweight / 10 lbs</td>
                                    <td data-label="Duration">7 min</td>
                                    <td data-label="Notes" class="notes-cell">Controlled movement</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="tabs-2" class="tab-content">
                <div class="content-placeholder">
                    <h1>Workout Status</h1>
                    <section class="card-container">
                        <article class="card stat-card">
                            <div class="card-header">
                                <h3>Calories Burned</h3>
                                <i class='bx bxs-hot'></i>
                            </div>
                            <div class="card-body">
                                <p class="value">12000.00 <span class="unit">kcal</span></p>
                                <p class="sub-value increase">(+10%)</p>
                                <p class="description">Total calories burned this month</p>
                            </div>
                        </article>
                        <article class="card stat-card">
                            <div class="card-header">
                                <h3>Workouts</h3>
                                <i class='bx bx-dumbbell'></i>
                            </div>
                            <div class="card-body">
                                <p class="value">5.00</p>
                                <p class="sub-value increase">(+1 workout)</p>
                                <p class="description">Workouts completed this week</p>
                            </div>
                        </article>
                        <article class="card stat-card">
                            <div class="card-header">
                                <h3>Avg. Duration</h3>
                                <i class='bx bx-time-five'></i>
                            </div>
                            <div class="card-body">
                                <p class="value">45.00 <span class="unit">min</span></p>
                                <p class="sub-value decrease">(-5 min)</p>
                                <p class="description">Average duration per workout</p>
                            </div>
                        </article>
                    </section>
                    <div class="input-block graph-controls">
                        <div class="control-group">
                            <i class='bx bx-line-chart'></i>
                            <label for="measurements">Measurements: </label>
                            <select name="measurements" id="measurements">
                                <option value="weight" data-unit="kg">Weight</option>
                                <option value="neck" data-unit="cm">Neck</option>
                                <option value="waist" data-unit="cm">Waist</option>
                                <option value="hips" data-unit="cm">Hips</option>
                            </select>
                        </div>
                        <div class="control-group">
                             <i class='bx bxs-calendar-check'></i>
                            <label for="graph-period">Period: </label>
                            <select name="graph-period" id="graph-period">
                                <option value="weekly" selected>1 Week</option>
                                <option value="monthly">1 Month</option>
                                <option value="3months">3 Months</option>
                                <option value="6months">6 Months</option>
                                <option value="yearly">1 Year</option>
                                <option value="start">Since Start</option>
                            </select>
                        </div>
                    </div>

                    <div class="graph-placeholder">
                        <div class="chart-area">
                            <h3 id="chart-title">Weight Progress (1 Week)</h3>
                            <div class="canvas-wrapper">
                                 <canvas id="progressChart"></canvas> <!-- Changed ID from myChart -->
                            </div>
                     </div>
                    </div>
                 </div>
            </div>

            <div id="tabs-3" class="tab-content">
                <div class="content-placeholder">
                    <h1>Nutrition Status:</h1>
                    <nav class="tabs">
                        <button class="tab-button active" data-tab="calories">CALORIES</button>
                        <button class="tab-button" data-tab="nutrients">NUTRIENTS</button>
                        <button class="tab-button" data-tab="macros">MACROS</button>
                    </nav>

                    <div id="calories-content" class="nutrition-tab-content active">
                         <h2>Calories Breakdown</h2>
                        <div class="chart-placeholder-container">
                            <canvas id="calorieChart"></canvas>
                        </div>
                        <div class="calories-breakdown">
                            <div class="meal-item">
                                <span class="color-square calorie-breakfast" style="background-color: #bf9a33;"></span>
                                <div class="meal-info">
                                    <div>Breakfast</div>
                                    <div data-value="breakfast-calories">0% (0 cal)</div>
                                </div>
                            </div>
                            <div class="meal-item">
                                <span class="color-square calorie-lunch" style="background-color: #febd14;"></span>
                                <div class="meal-info">
                                    <div>Lunch</div>
                                    <div data-value="lunch-calories">0% (0 cal)</div>
                                </div>
                            </div>
                            <div class="meal-item">
                                <span class="color-square calorie-dinner" style="background-color: #fece43;"></span>
                                 <div class="meal-info">
                                   <div>Dinner</div>
                                   <div data-value="dinner-calories">0% (0 cal)</div>
                                 </div>
                            </div>
                            <div class="meal-item">
                                <span class="color-square calorie-snacks" style="background-color: #feda75;"></span>
                                 <div class="meal-info">
                                    <div>Snacks</div>
                                    <div data-value="snack-calories">0% (0 cal)</div>
                                 </div>
                            </div>
                        </div>
                        <div class="calorie-summary">
                            <div class="summary-item">
                                <span>Total Calories</span>
                                <span data-value="total-calories">0</span>
                            </div>
                             <div class="summary-item">
                                <span>Exercise</span>
                                <span data-value="exercise-calories" class="exercise">0</span>
                            </div>
                            <div class="summary-item net-calories-item">
                                <span>Net Calories</span>
                                <span data-value="net-calories">0</span>
                            </div>
                             <hr class="summary-divider">
                            <div class="summary-item goal">
                                <span>Goal</span>
                                <span data-value="goal-calories">1,520</span>
                            </div>
                        </div>
                    </div>

                    <div id="nutrients-content" class="nutrition-tab-content">
                         <h2>Nutrient Details</h2>
                        <div class="nutrition-details-full">
                            <div class="nutrient-header">
                                <span>Nutrient</span>
                                <span>Total</span>
                                <span>Goal</span>
                                <span>Left</span>
                            </div>
                            <ul class="nutrient-list">
                                <li data-nutrient="protein">
                                    <span>Protein</span>
                                    <span data-value="protein-total">0 g</span>
                                    <span data-value="protein-goal">76 g</span>
                                    <span data-value="protein-left">76 g</span>
                                </li>
                                <li data-nutrient="carbohydrates">
                                    <span>Carbohydrates</span>
                                    <span data-value="carbs-total">0 g</span>
                                    <span data-value="carbs-goal">190 g</span>
                                    <span data-value="carbs-left">190 g</span>
                                </li>
                                <li data-nutrient="fiber">
                                    <span>Fiber</span>
                                    <span data-value="fiber-total">0 g</span>
                                    <span data-value="fiber-goal">25 g</span>
                                    <span data-value="fiber-left">25 g</span>
                                </li>
                                <li data-nutrient="sugar">
                                    <span>Sugar</span>
                                    <span data-value="sugar-total">0 g</span>
                                    <span data-value="sugar-goal">57 g</span>
                                    <span data-value="sugar-left">57 g</span>
                                </li>
                                <li data-nutrient="fat">
                                    <span>Fat</span>
                                    <span data-value="fat-total">0 g</span>
                                    <span data-value="fat-goal">51 g</span>
                                    <span data-value="fat-left">51 g</span>
                                </li>
                                <li data-nutrient="saturated_fat">
                                    <span>Saturated Fat</span>
                                    <span data-value="satfat-total">0 g</span>
                                    <span data-value="satfat-goal">17 g</span>
                                    <span data-value="satfat-left">17 g</span>
                                </li>
                                <li data-nutrient="polyunsaturated_fat">
                                    <span>Polyunsaturated Fat</span>
                                    <span data-value="polyfat-total">0 g</span>
                                    <span data-value="polyfat-goal">0 g</span>
                                    <span data-value="polyfat-left">0 g</span>
                                </li>
                                <li data-nutrient="monounsaturated_fat">
                                    <span>Monounsaturated Fat</span>
                                    <span data-value="monofat-total">0 g</span>
                                    <span data-value="monofat-goal">0 g</span>
                                    <span data-value="monofat-left">0 g</span>
                                </li>
                                <li data-nutrient="trans_fat">
                                    <span>Trans Fat</span>
                                    <span data-value="transfat-total">0 g</span>
                                    <span data-value="transfat-goal">0 g</span>
                                    <span data-value="transfat-left">0 g</span>
                                </li>
                                <li data-nutrient="cholesterol">
                                    <span>Cholesterol</span>
                                    <span data-value="cholesterol-total">0 mg</span>
                                    <span data-value="cholesterol-goal">300 mg</span>
                                    <span data-value="cholesterol-left">300 mg</span>
                                </li>
                                <li data-nutrient="sodium">
                                    <span>Sodium</span>
                                    <span data-value="sodium-total">0 mg</span>
                                    <span data-value="sodium-goal">2,300 mg</span>
                                    <span data-value="sodium-left">2,300 mg</span>
                                </li>
                                <li data-nutrient="potassium">
                                    <span>Potassium</span>
                                    <span data-value="potassium-total">0 mg</span>
                                    <span data-value="potassium-goal">3,500 mg</span>
                                    <span data-value="potassium-left">3,500 mg</span>
                                </li>
                                <li data-nutrient="vitamin_a">
                                    <span>Vitamin A</span>
                                    <span data-value="vita-total">0 %</span>
                                    <span data-value="vita-goal">100 %</span>
                                    <span data-value="vita-left">100 %</span>
                                </li>
                                <li data-nutrient="vitamin_c">
                                    <span>Vitamin C</span>
                                    <span data-value="vitc-total">0 %</span>
                                    <span data-value="vitc-goal">100 %</span>
                                    <span data-value="vitc-left">100 %</span>
                                </li>
                                <li data-nutrient="calcium">
                                    <span>Calcium</span>
                                    <span data-value="calcium-total">0 %</span>
                                    <span data-value="calcium-goal">100 %</span>
                                    <span data-value="calcium-left">100 %</span>
                                </li>
                                <li data-nutrient="iron">
                                    <span>Iron</span>
                                    <span data-value="iron-total">0 %</span>
                                    <span data-value="iron-goal">100 %</span>
                                    <span data-value="iron-left">100 %</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div id="macros-content" class="nutrition-tab-content">
                         <h2>Macronutrient Ratio</h2>
                        <div class="chart-placeholder-container">
                             <canvas id="macroChart"></canvas>
                        </div>
                        <div class="macros-legend">
                             <div class="legend-item" data-macro="carbs">
                                <span class="color-square macro-carbs" style="background-color: #febd14;"></span>
                                <span>Carbohydrates (<span data-value="carbs-grams">0g</span>)</span>
                                <span class="percentage" data-value="carbs-percentage">0%</span>
                                <span class="goal-percentage">50%</span>
                            </div>
                             <div class="legend-item" data-macro="fat">
                                <span class="color-square macro-fat" style="background-color: #fece43;"></span>
                                <span>Fat (<span data-value="fat-grams">0g</span>)</span>
                                <span class="percentage" data-value="fat-percentage">0%</span>
                                <span class="goal-percentage">30%</span>
                            </div>
                             <div class="legend-item" data-macro="protein">
                                <span class="color-square macro-protein" style="background-color: #feda75;"></span>
                                <span>Protein (<span data-value="protein-grams">0g</span>)</span>
                                <span class="percentage" data-value="protein-percentage">0%</span>
                                <span class="goal-percentage">20%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal structure (Keep outside main if it overlays everything) -->
    <div id="logoutConfirmationModal" class="modal">
        <div class="modal-content">
            <button id="closeLogoutModalButton" class="close-button">×</button>
            <p id="logoutModalMessage">Are you sure you want to logout?</p>
            <div style="text-align: center;">
                 <button id="cancelLogoutButton" class="btn-secondary">Cancel</button>
                 <button id="okLogoutButton" class="btn-primary">Logout</button>
            </div>
        </div>
    </div>

    <section id="subscribe" class="subscribe-section">
        <div class="container subscribe-content">
             <div class="subscribe-text">
                <h2>Subscribe</h2>
                <p>Join our fitness family and get tips, exclusive updates, and special offers. Start your journey today!</p>
                <form class="subscribe-form">
                    <input type="email" placeholder="Email" required>
                    <button type="submit" class="btn btn-primary">Send</button>
                </form>
                <div class="social-icons">
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
                    <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                </div>
            </div>

            <div class="footer-links">
                 <div><h4>Company</h4><ul><li><a href="#">Press</a></li><li><a href="#">Blog</a></li><li><a href="#">About</a></li><li><a href="#">Careers</a></li></ul></div> <div><h4>Services</h4><ul><li><a href="#">Training</a></li><li><a href="#">Nutrition</a></li><li><a href="#">Lifestyles</a></li></ul></div> <div><h4>Legal</h4><ul><li><a href="#">Policy</a></li><li><a href="#">Privacy & Cookies</a></li><li><a href="#">Terms & Conditions</a></li></ul></div> <div><h4>Community</h4><ul><li><a href="#">Contact</a></li><li><a href="#">Find a club</a></li><li><a href="#">Membership</a></li></ul></div> <div><h4>Gym</h4><ul><li><a href="#">Book a Gym</a></li><li><a href="#">Find a Gym</a></li></ul></div>
            </div>
        </div>
    </section>
    <footer>
        <div class="container">
            <p>© 2024 OPTILIFE. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@1.0.1/dist/chartjs-adapter-moment.min.js"></script>
    <!-- Removed link to external JS file -->
    <!-- <script src="progress.js"></script> -->

    <script>
        $(document).ready(function() {
            // --- Header Menu Toggle ---
            var menuIcon = $('#menu-icon');
            var navbar = $('.navbar');
            var logoutLink = $('#logout-link');
            var logoutModal = $('#logoutConfirmationModal');
            var closeLogoutModalBtn = $('#closeLogoutModalButton');
            var cancelLogoutBtn = $('#cancelLogoutButton');
            var okLogoutBtn = $('#okLogoutButton');

            if (menuIcon.length && navbar.length) {
                menuIcon.on('click', function() {
                    $(this).toggleClass('bx-x');
                    navbar.toggleClass('active');
                });

                // Close menu when a link is clicked (except logout)
                $('.navbar a').on('click', function(event) {
                     if (navbar.hasClass('active') && !$(this).is('#logout-link')) {
                         navbar.removeClass('active');
                         menuIcon.removeClass('bx-x');
                     }
                });

                // Close menu if profile pic area is clicked while menu open
                $('.navbar-right li:has(.profile-pic)').on('click', function(e) {
                     if(navbar.hasClass('active')) {
                          navbar.removeClass('active');
                          menuIcon.removeClass('bx-x');
                     }
                });

                // Close menu on scroll
                $(window).on('scroll', function() {
                    if (navbar.hasClass('active')) {
                        navbar.removeClass('active');
                        menuIcon.removeClass('bx-x');
                    }
                });
            } else {
                console.warn("Header menu icon or navbar not found.");
            }

            // --- Logout Modal Logic ---
            if (logoutLink.length && logoutModal.length) {
                logoutLink.on('click', function(event) {
                    event.preventDefault(); // Prevent default link navigation
                    logoutModal.addClass('show'); // Show the modal
                });

                closeLogoutModalBtn.on('click', function() {
                    logoutModal.removeClass('show'); // Hide modal
                });

                cancelLogoutBtn.on('click', function() {
                    logoutModal.removeClass('show'); // Hide modal
                });

                okLogoutBtn.on('click', function() {
                    logoutModal.removeClass('show'); // Hide modal
                    // Redirect to the original logout link's href
                    window.location.href = logoutLink.attr('href');
                });

                // Close modal if clicked outside the content
                $(window).on('click', function(event) {
                    if ($(event.target).is(logoutModal)) {
                        logoutModal.removeClass('show');
                    }
                });
            } else {
                 console.warn("Logout link or modal not found.");
                 // Fallback for original non-modal behavior if needed
                 $('#logout-link').on('click', function(event) {
                      event.preventDefault();
                      var confirmLogout = confirm("Are you sure you want to logout?");
                      if (confirmLogout) {
                          window.location.href = this.href;
                      }
                 });
            }


            // --- Main Tab Switching ---
            $('.main-tab-button').on('click', function() {
                var targetSelector = $(this).data('target');
                var $targetContent = $(targetSelector);

                if ($targetContent.length) {
                    // Switch main tabs
                    $('.main-tab-button').removeClass('active');
                    $(this).addClass('active');
                    $('.main-tab-content > .tab-content').removeClass('active'); // Target only direct children
                    $targetContent.addClass('active');

                    // Initialize or update charts if the target tab contains them
                    if (targetSelector === '#tabs-2') {
                        initializeOrUpdateProgressChart();
                    } else if (targetSelector === '#tabs-3') {
                         initializeOrUpdateNutritionCharts();
                         // Ensure the correct inner nutrition tab is shown
                         const activeNutritionButton = $('#tabs-3 .tabs .tab-button.active');
                         if (activeNutritionButton.length) {
                             const targetNutritionTab = activeNutritionButton.data('tab');
                             $('#tabs-3 .nutrition-tab-content').removeClass('active');
                             $('#' + targetNutritionTab + '-content').addClass('active');
                         }
                    }
                } else {
                    console.warn("Main tab target content not found:", targetSelector);
                }
            });

            // --- Nutrition Inner Tab Switching ---
             $('.tabs .tab-button').on('click', function() {
                  var tabId = $(this).data('tab');
                  var $container = $(this).closest('.content-placeholder');

                  $container.find('.tabs .tab-button').removeClass('active');
                  $(this).addClass('active');

                  $container.find('.nutrition-tab-content').removeClass('active');
                  $('#' + tabId + '-content').addClass('active');

                  // Re-initialize charts if switching back to a chart tab within nutrition
                  if (tabId === 'calories' || tabId === 'macros') {
                      initializeOrUpdateNutritionCharts();
                  }
             });

            // --- Chart.js Implementations ---
            let progressChartInstance = null;
            let calorieChartInstance = null;
            let macroChartInstance = null;

            // Function to get placeholder data for the progress chart
            function getProgressChartData(period, measurement) {
                // --- Placeholder Data ---
                // In a real application, this data would be fetched based on period and measurement
                let labels = [];
                let data = [];
                let unit = $('#measurements option:selected').data('unit') || 'kg';
                let startDate = moment().subtract(6, 'days'); // Default to 1 week

                let days = 7;
                if (period === 'monthly') { startDate = moment().subtract(1, 'month'); days = 30; }
                else if (period === '3months') { startDate = moment().subtract(3, 'months'); days = 90; }
                else if (period === '6months') { startDate = moment().subtract(6, 'months'); days = 180; }
                else if (period === 'yearly') { startDate = moment().subtract(1, 'year'); days = 365; }
                // 'start' would require fetching the actual start date

                let startValue = 70; // Example start value
                if (measurement === 'neck') startValue = 38;
                else if (measurement === 'waist') startValue = 85;
                else if (measurement === 'hips') startValue = 100;

                for (let i = 0; i < days; i++) {
                    labels.push(startDate.clone().add(i, 'days').toDate());
                    // Simulate some data fluctuation
                    data.push(startValue + (Math.random() * 4 - 2) * (measurement === 'weight' ? 1 : 0.5) - (i * 0.05)); // Simulate slight downward trend
                }

                return { labels, data, unit };
            }

            // Initialize or Update Progress Line Chart
            function initializeOrUpdateProgressChart() {
                const ctx = document.getElementById('progressChart');
                if (!ctx) return; // Exit if canvas not found

                const measurementSelect = $('#measurements');
                const periodSelect = $('#graph-period');
                const chartTitle = $('#chart-title');

                const selectedMeasurement = measurementSelect.val();
                const selectedPeriod = periodSelect.val();
                const measurementText = measurementSelect.find('option:selected').text();
                const periodText = periodSelect.find('option:selected').text();

                // Update chart title
                chartTitle.text(`${measurementText} Progress (${periodText})`);

                // Get placeholder data
                const { labels, data, unit } = getProgressChartData(selectedPeriod, selectedMeasurement);

                // Destroy previous chart instance if it exists
                if (progressChartInstance) {
                    progressChartInstance.destroy();
                }

                // Create new chart
                progressChartInstance = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: `${measurementText} (${unit})`,
                            data: data,
                            borderColor: 'rgba(218, 165, 32, 1)', // Goldenrod
                            backgroundColor: 'rgba(218, 165, 32, 0.1)',
                            borderWidth: 2,
                            tension: 0.1, // Makes the line slightly curved
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                     unit: labels.length > 90 ? 'month' : (labels.length > 7 ? 'week' : 'day'), // Adjust time unit based on data range
                                     tooltipFormat: 'll' // e.g., Sep 4, 1986
                                },
                                title: {
                                    display: true,
                                    text: 'Date'
                                }
                            },
                            y: {
                                beginAtZero: false, // Don't force y-axis to start at 0 for measurements like weight
                                title: {
                                    display: true,
                                    text: `${measurementText} (${unit})`
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        }
                    }
                });
            }

            // Function to update Nutrition UI based on data
            function updateNutritionUI(calorieData, macroData, goalCalories, goalMacros) {
                // --- Update Calorie Breakdown ---
                const totalCalories = Object.values(calorieData).reduce((sum, val) => sum + val, 0);
                const exerciseCalories = 250; // Placeholder exercise calories

                $('[data-value="total-calories"]').text(totalCalories.toLocaleString());
                $('[data-value="exercise-calories"]').text(exerciseCalories.toLocaleString());
                $('[data-value="net-calories"]').text((totalCalories - exerciseCalories).toLocaleString());
                $('[data-value="goal-calories"]').text(goalCalories.toLocaleString());

                // Update meal percentages/calories
                const mealTargets = {
                    'breakfast-calories': $('[data-value="breakfast-calories"]'),
                    'lunch-calories': $('[data-value="lunch-calories"]'),
                    'dinner-calories': $('[data-value="dinner-calories"]'),
                    'snack-calories': $('[data-value="snack-calories"]')
                };
                for(const meal in calorieData) {
                    const key = `${meal}-calories`;
                    if (mealTargets[key]) {
                        const percentage = totalCalories > 0 ? Math.round((calorieData[meal] / totalCalories) * 100) : 0;
                         mealTargets[key].text(`${percentage}% (${calorieData[meal].toLocaleString()} cal)`);
                    }
                }

                // --- Update Nutrient Details (Basic Example - linking macros) ---
                $('[data-value="protein-total"]').text(`${macroData.protein} g`);
                $('[data-value="carbs-total"]').text(`${macroData.carbs} g`);
                $('[data-value="fat-total"]').text(`${macroData.fat} g`);
                // Add logic to calculate 'left' values based on goals if available
                 // Example for protein left:
                const proteinGoal = parseInt($('[data-value="protein-goal"]').text()) || 0;
                $('[data-value="protein-left"]').text(`${Math.max(0, proteinGoal - macroData.protein)} g`);
                 // Example for carbs left:
                const carbsGoal = parseInt($('[data-value="carbs-goal"]').text()) || 0;
                $('[data-value="carbs-left"]').text(`${Math.max(0, carbsGoal - macroData.carbs)} g`);
                 // Example for fat left:
                const fatGoal = parseInt($('[data-value="fat-goal"]').text()) || 0;
                $('[data-value="fat-left"]').text(`${Math.max(0, fatGoal - macroData.fat)} g`);
                // ... Calculate others similarly if goals are numeric ...


                // --- Update Macros Legend ---
                const totalGrams = macroData.carbs + macroData.fat + macroData.protein;
                const carbsPercent = totalGrams > 0 ? Math.round((macroData.carbs * 4 / (macroData.carbs*4 + macroData.fat*9 + macroData.protein*4)) * 100) : 0; // Calculate % calories
                const fatPercent = totalGrams > 0 ? Math.round((macroData.fat * 9 / (macroData.carbs*4 + macroData.fat*9 + macroData.protein*4)) * 100) : 0; // Calculate % calories
                // Ensure protein makes up the remainder to avoid rounding errors summing > 100%
                const proteinPercent = totalGrams > 0 ? Math.max(0, 100 - carbsPercent - fatPercent) : 0;


                $('[data-value="carbs-grams"]').text(`${macroData.carbs}g`);
                $('[data-value="carbs-percentage"]').text(`${carbsPercent}%`);
                $('[data-value="fat-grams"]').text(`${macroData.fat}g`);
                $('[data-value="fat-percentage"]').text(`${fatPercent}%`);
                $('[data-value="protein-grams"]').text(`${macroData.protein}g`);
                $('[data-value="protein-percentage"]').text(`${proteinPercent}%`);

                // Update goal percentages (if provided)
                if (goalMacros) {
                    $('[data-macro="carbs"] .goal-percentage').text(`${goalMacros.carbs}%`);
                    $('[data-macro="fat"] .goal-percentage').text(`${goalMacros.fat}%`);
                    $('[data-macro="protein"] .goal-percentage').text(`${goalMacros.protein}%`);
                }
            }


            // Initialize or Update Nutrition Pie Charts
            function initializeOrUpdateNutritionCharts() {
                 // --- Placeholder Nutrition Data ---
                 const calorieData = {
                     breakfast: 350,
                     lunch: 550,
                     dinner: 600,
                     snacks: 180
                 };
                 const macroData = { // In grams
                     carbs: 195,
                     fat: 60,
                     protein: 75
                 };
                 const goalCalories = parseInt($('[data-value="goal-calories"]').text().replace(/,/g, '')) || 1520; // Read from HTML or default
                 const goalMacros = { // Percentages
                     carbs: parseInt($('[data-macro="carbs"] .goal-percentage').text()) || 50,
                     fat: parseInt($('[data-macro="fat"] .goal-percentage').text()) || 30,
                     protein: parseInt($('[data-macro="protein"] .goal-percentage').text()) || 20
                 };

                 // Update the UI text elements first
                 updateNutritionUI(calorieData, macroData, goalCalories, goalMacros);


                // --- Calorie Chart ---
                const calorieCtx = document.getElementById('calorieChart');
                if (calorieCtx) {
                    if (calorieChartInstance) {
                        calorieChartInstance.destroy();
                    }
                    calorieChartInstance = new Chart(calorieCtx.getContext('2d'), {
                        type: 'doughnut',
                        data: {
                            labels: ['Breakfast', 'Lunch', 'Dinner', 'Snacks'],
                            datasets: [{
                                label: 'Calories',
                                data: [
                                    calorieData.breakfast,
                                    calorieData.lunch,
                                    calorieData.dinner,
                                    calorieData.snacks
                                ],
                                backgroundColor: [
                                    '#bf9a33', // breakfast color from legend
                                    '#febd14', // lunch color
                                    '#fece43', // dinner color
                                    '#feda75'  // snacks color
                                ],
                                borderColor: '#ffffff',
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false // Using custom HTML legend
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.parsed !== null) {
                                                label += context.parsed.toLocaleString() + ' cal';
                                            }
                                            return label;
                                        }
                                    }
                                }
                            },
                            cutout: '60%' // Make it a doughnut chart
                        }
                    });
                }


                // --- Macro Chart ---
                const macroCtx = document.getElementById('macroChart');
                if (macroCtx) {
                    if (macroChartInstance) {
                        macroChartInstance.destroy();
                    }

                    // Use macro G GRAMS for the chart data segments
                    const macroChartDataValues = [
                        macroData.carbs,
                        macroData.fat,
                        macroData.protein
                    ];
                     const totalCaloriesFromMacros = (macroData.carbs * 4) + (macroData.fat * 9) + (macroData.protein * 4);


                    macroChartInstance = new Chart(macroCtx.getContext('2d'), {
                        type: 'doughnut',
                        data: {
                            labels: ['Carbohydrates', 'Fat', 'Protein'],
                            datasets: [{
                                label: 'Macronutrients (Calories)', // Tooltip label base
                                data: [ // Data represents CALORIE contribution for better visual proportion
                                    macroData.carbs * 4,
                                    macroData.fat * 9,
                                    macroData.protein * 4
                                ],
                                backgroundColor: [
                                    '#febd14', // carbs color from legend
                                    '#fece43', // fat color
                                    '#feda75'  // protein color
                                ],
                                borderColor: '#ffffff',
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false // Using custom HTML legend
                                },
                                tooltip: {
                                     callbacks: {
                                        label: function(context) {
                                            let label = context.label || '';
                                            let calorieValue = context.parsed || 0;
                                            let gramValue = 0;
                                            if (label === 'Carbohydrates') gramValue = macroData.carbs;
                                            else if (label === 'Fat') gramValue = macroData.fat;
                                            else if (label === 'Protein') gramValue = macroData.protein;

                                            let percentage = totalCaloriesFromMacros > 0 ? Math.round((calorieValue / totalCaloriesFromMacros) * 100) : 0;
                                            if (label) {
                                                label += ': ';
                                            }
                                            // Show grams and percentage in tooltip
                                            label += gramValue.toLocaleString() + 'g (' + percentage + '%)';
                                            return label;
                                        }
                                    }
                                }
                            },
                            cutout: '60%' // Make it a doughnut chart
                        }
                    });
                }
            }

            // --- Event Listeners for Chart Updates ---
            $('#measurements, #graph-period').on('change', function() {
                // Only update if the workout status tab is active
                if ($('#tabs-2').hasClass('active')) {
                    initializeOrUpdateProgressChart();
                }
            });

            // --- Initial Chart Load on Page Ready ---
            // Check which tab is active initially and load its charts
            if ($('#tabs-2').hasClass('active')) {
                initializeOrUpdateProgressChart();
            } else if ($('#tabs-3').hasClass('active')) {
                 // Need to ensure the inner tab content is visible *before* initializing chart
                 const activeNutritionButton = $('#tabs-3 .tabs .tab-button.active');
                 if (activeNutritionButton.length) {
                     const targetNutritionTab = activeNutritionButton.data('tab');
                     $('#tabs-3 .nutrition-tab-content').removeClass('active'); // Ensure others are hidden
                     $('#' + targetNutritionTab + '-content').addClass('active'); // Show the correct one
                 } else {
                      // Default to showing calories if none are active
                      $('#calories-content').addClass('active');
                 }
                initializeOrUpdateNutritionCharts();
            }

        }); // End document ready
    </script>

</body>
</html>
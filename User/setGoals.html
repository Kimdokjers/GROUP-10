<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set Goals - OptiLife</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <!-- Link to the external home.css for header/footer base -->
    <link rel="stylesheet" href="usercss/home.css">

    <style>
        /* Inherit variables from home.css, override/add specifics for setGoals dark theme */
        :root {
            /* Base Theme Colors (Keep consistent) */
            --bg-color: #000;
            --snd-bf-color: #111;
            --text-color: #ffffff; /* Default light text */
            --main-color: #FFD700; /* Primary Gold */
            --color-black: #0a0a0a;
            --color-dark-gray: #1a1a1a; /* Main dark background for cards */
            --color-gold: #DAA520; /* Keep if needed */
            --color-gold-light: #f0c44c;
            --color-text-muted: #aaaaaa; /* Muted light text */
            --border-color-light: #333; /* Dark border */
            --header-height-desktop: 100px;
            --header-height-mobile: 80px;
            --font-primary: 'Poppins', sans-serif;

            /* SetGoals Page Specific Dark Theme Variables */
            --card-bg-setgoals: var(--color-dark-gray); /* Dark background for cards */
            --text-dark-setgoals: var(--text-color); /* Light text for dark cards */
            --text-muted-setgoals: var(--color-text-muted); /* Use muted light text */
            --border-color-light-setgoals: var(--border-color-light); /* Darker border */
            --primary-color-darkest-setgoals: var(--main-color); /* Use main gold for emphasis */
            --grid-gap: 1.5rem;
            --content-padding: 1.5rem;
            --button-primary-bg: var(--main-color); /* Keep Gold */
            --button-primary-text: var(--color-black); /* Keep Black text */
            --button-primary-hover-bg: var(--color-gold-light); /* Lighter gold hover */
            --button-secondary-bg: #555; /* Darker secondary button */
            --button-secondary-text: var(--text-color); /* Light text */
            --button-secondary-hover-bg: #666; /* Slightly lighter dark hover */
            --modal-overlay-bg: rgba(0, 0, 0, 0.7);
            --input-bg-setgoals: #252525; /* Dark input bg */
            --input-focus-shadow: rgba(255, 215, 0, 0.3); /* Gold focus glow */
            --modal-bg-setgoals: var(--color-dark-gray); /* Dark modal background */
            --modal-text-setgoals: var(--text-color); /* Light modal text */
            --table-header-bg: #252525; /* Darker header bg for potential tables */
            --table-row-even-bg: #222; /* Slightly different dark for stripes */
            --table-row-hover-bg: #303030; /* Darker hover */
            --table-border-color: var(--border-color-light-setgoals); /* Use dark border var */
            --tab-inactive-bg: #333; /* Dark inactive tab bg */
            --tab-inactive-text: var(--text-muted-setgoals); /* Muted text */
            --tab-hover-bg: #444; /* Dark hover for tabs */
            --tab-hover-text: var(--text-color); /* Brighter text on hover */
        }

        /* Apply dark theme base to body if not covered by home.css */
        body {
            background-color: var(--bg-color);
            color: var(--text-color); /* Default text color */
        }

        main.content-grid {
            padding-top: calc(var(--header-height-desktop, 100px) + 2rem);
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: var(--grid-gap);
            padding-left: var(--content-padding);
            padding-right: var(--content-padding);
            padding-bottom: var(--content-padding);
            color: var(--text-dark-setgoals); /* Light text for grid content */
        }

        .card {
            background-color: var(--card-bg-setgoals); /* Dark bg */
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3); /* Darker shadow */
            border: 1px solid var(--border-color-light-setgoals); /* Dark border */
            color: var(--text-dark-setgoals); /* Light text */
        }

        .calendar-widget {
             border: 2px solid var(--primary-color-darkest-setgoals); /* Gold border */
        }

        /* Keep specific Gold labels/headers */
        .calendar-widget h2,
        .calendar-widget .input-block label,
        .nutrient-header span:first-child,
        #log-meal-modal h3,
        #log-meal-modal .logged-items-display h4 {
             color: var(--primary-color-darkest-setgoals) !important;
        }

        .calendar-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; font-weight: 500;
            color: var(--text-dark-setgoals); /* Light text */
        }
        .cal-nav {
            border: 1px solid var(--border-color-light-setgoals); /* Dark border */
            color: var(--text-muted-setgoals); /* Muted light */
            padding: 3px 8px; border-radius: 4px; cursor: pointer; background: none;
        }
        .cal-nav:hover { color: var(--primary-color-darkest-setgoals); border-color: var(--primary-color-darkest-setgoals); }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; margin-bottom: 1.5rem; }
        .day-name {
            font-weight: 600; font-size: 0.8rem;
            color: var(--text-muted-setgoals); /* Muted light */
            text-transform: uppercase;
        }
        .date-cell { display: flex; justify-content: center; align-items: center; aspect-ratio: 1 / 1; }
        .date-cell button {
            width: 100%; height: 100%; border-radius: 50%; border: 2px solid transparent;
            background-color: transparent;
            color: var(--text-dark-setgoals); /* Light text */
            cursor: pointer;
            font-size: 0.9rem; transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
            display: flex; align-items: center; justify-content: center; padding: 0;
        }
        .date-cell button:hover:not(.selected):not(:disabled) {
            background-color: #333; /* Dark hover */
            border-color: var(--border-color-light-setgoals);
        }
        .date-cell button.selected { background-color: var(--main-color); color: var(--color-black); font-weight: bold; border-color: var(--color-gold); }
        .date-cell.empty { visibility: hidden; }
        .date-cell button:disabled {
            color: #666; /* Darker disabled text */
            cursor: default; background-color: transparent;
        }


        .calendar-widget .input-block { margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color-light-setgoals); }
        .calendar-widget .input-block:last-child { border-bottom: none; padding-bottom: 0; margin-bottom: 0; }
        /* Label color set above to gold */
        .calendar-widget .info-input,
        .input-group input[type="text"],
        .input-group input[type="number"],
        .input-group select {
            background-color: var(--input-bg-setgoals); /* Dark bg */
            border: 1px solid var(--border-color-light-setgoals); /* Dark border */
            color: var(--text-dark-setgoals); /* Light text */
            font-size: 0.95rem; padding: 8px 10px; width: 100%; border-radius: 4px;
        }
        .calendar-widget .info-input:focus,
        .input-group input[type="text"]:focus,
        .input-group input[type="number"]:focus,
        .input-group select:focus {
            outline: none; border-color: var(--main-color); /* Gold border focus */
            box-shadow: 0 0 0 2px var(--input-focus-shadow); /* Gold glow focus */
        }
        /* Make select arrow visible on dark bg */
        .input-group select {
             background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23aaaaaa' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
             background-repeat: no-repeat;
             background-position: right 0.75rem center;
             background-size: 16px 12px;
             appearance: none; /* Remove default arrow */
             -webkit-appearance: none;
             -moz-appearance: none;
        }


        .main-tab-content {
            border: 2px solid var(--primary-color-darkest-setgoals); /* Gold border */
            border-radius: 8px;
            background-color: var(--card-bg-setgoals); /* Dark bg */
            color: var(--text-dark-setgoals); /* Light text */
            min-width: 0;
        }
        .tab-content {
             display: none;
        }
        .tab-content.active {
             display: block;
             animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .content-placeholder { padding: 1.5rem; background-color: transparent; border-radius: 0; border: none; min-height: 300px; box-shadow: none; }
        .content-placeholder h1 {
            font-size: 1.8rem; margin-bottom: 1.5rem; font-weight: 600;
            color: var(--text-dark-setgoals); /* Light text */
            text-align: left; padding-bottom: 0.8rem;
            border-bottom: 2px solid var(--main-color); /* Gold border */
            display: inline-block;
        }
        .content-placeholder h1::before { /* Adjust color of prefix text */
            font-weight: normal;
            color: var(--text-muted-setgoals); /* Muted light */
        }

        .main-content-tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 2rem;
            padding: 1rem 1.5rem;
            border-bottom: 2px solid var(--border-color-light-setgoals); /* Dark border */
            gap: 1rem;
        }
        button.main-tab-button {
            display: inline-flex; align-items: center; gap: 0.7rem;
            padding: 0.8rem 1.5rem; font-size: 1.5rem; font-weight: 500;
            color: var(--tab-inactive-text); /* Muted light */
            background-color: var(--tab-inactive-bg); /* Dark inactive */
            border: 1px solid #444; /* Darker border */
            border-radius: 6px;
            cursor: pointer; transition: all 0.3s ease;
            font-family: inherit;
        }
        button.main-tab-button i { font-size: 1.8rem; line-height: 1; }
        button.main-tab-button:hover {
            background-color: var(--tab-hover-bg); /* Dark hover */
            border-color: #555;
            color: var(--tab-hover-text); /* Brighter text */
        }
        button.main-tab-button.active {
            background-color: var(--main-color); color: var(--color-black);
            font-weight: 600; border-color: var(--color-gold);
            box-shadow: 0 2px 5px rgba(218, 165, 32, 0.2);
        }

        /* Fitness Goals Tab (#tabs-1) */
        .activity-planner.card {
            border: 1px solid var(--border-color-light-setgoals); /* Dark border */
            background-color: var(--snd-bf-color); /* Slightly different dark bg */
            padding: 1.5rem; border-radius: 5px; margin-top: 1rem;
        }
        .activity-planner h2, .activity-planner h3 {
            color: var(--primary-color-darkest-setgoals); /* Gold headers */
            margin-bottom: 1rem;
        }
        .activity-planner h3 { margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border-color-light-setgoals); }
        .activity-planner .activity-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; align-items: flex-end; margin-bottom: 1.5rem; }
        .input-group label {
            display: block; margin-bottom: 5px;
            color: var(--text-muted-setgoals); /* Muted light */
            font-weight: 500; font-size: 0.9rem;
        }
        /* Input/Select styles inherited from above */
        #add-activity-btn {
            grid-column: 1 / -1; width: auto; justify-self: start; padding: 10px 25px; margin-top: 10px;
            background-color: var(--button-primary-bg); /* Gold bg */
            color: var(--button-primary-text); /* Black text */
            font-weight: 600; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s ease;
        }
        #add-activity-btn:hover { background-color: var(--button-primary-hover-bg); } /* Lighter gold */
        #weekly-plan-display { margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
        .day-schedule {
            background-color: var(--input-bg-setgoals); /* Dark bg */
            padding: 1rem; border-radius: 5px;
            border: 1px solid var(--border-color-light-setgoals);
        }
        .day-schedule h4 {
            color: var(--text-dark-setgoals); /* Light text */
            border-bottom: 1px solid var(--main-color); /* Gold border */
            padding-bottom: 5px; margin-bottom: 10px; font-weight: 600;
        }
        .day-schedule ul { min-height: 30px; padding-left: 0; list-style: none; margin: 0; }
        .day-schedule li {
            background-color: var(--card-bg-setgoals); /* Slightly lighter dark */
            padding: 10px 15px; margin-bottom: 8px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;
            border: 1px solid var(--border-color-light); /* Darker border */
            font-size: 0.9rem; word-break: break-word; position: relative;
            color: var(--text-dark-setgoals); /* Light text */
        }
        .day-schedule li .remove-activity-btn {
            background: none; border: none; color: #f44336; /* Keep red */
            font-size: 1.1rem; line-height: 1; cursor: pointer;
            padding: 2px 5px; margin-left: 10px; transition: color 0.2s ease;
        }
        .day-schedule li .remove-activity-btn:hover { color: #d32f2f; }


        /* Nutrition Goals Tab (#tabs-3) */
        .tabs { display: flex; justify-content: center; flex-wrap: wrap; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color-light-setgoals); padding-bottom: 0.5rem; gap: 10px; }
        .tabs .tab-button {
            color: var(--tab-inactive-text); font-size: 0.95rem; padding: 0.6rem 1rem; border-radius: 4px; transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease; white-space: nowrap;
            border: 2px solid transparent; background-color: transparent; cursor: pointer; font-weight: 500;
        }
        .tab-button:hover {
            color: var(--tab-hover-text); background-color: var(--tab-hover-bg);
        }
        .tab-button.active { background-color: var(--main-color); color: var(--color-black); font-weight: 600; border-color: var(--color-gold); }
        .nutrition-tab-content { display: none; padding-top: 1rem; animation: fadeIn 0.5s ease-in-out; }
        .nutrition-tab-content.active { display: block; }
        .nutrition-tab-content h2 {
            font-size: 1.3rem; margin-bottom: 1.5rem; font-weight: 600;
            color: var(--text-muted-setgoals); /* Muted light */
            text-align: center;
        }
        .nutrition-details-full { max-width: 700px; margin: 0 auto; }
        .calories-breakdown { display: flex; flex-direction: column; gap: 0.8rem; margin-bottom: 1.5rem; }
        .meal-item {
            display: flex; align-items: center; gap: 10px; padding: 10px 12px;
            background-color: var(--snd-bf-color); /* Secondary dark bg */
            border-radius: 4px; border: 1px solid var(--border-color-light-setgoals);
        }
        .meal-info { font-size: 0.9rem; flex-grow: 1; }
        .meal-info div:first-child { font-weight: 500; color: var(--text-dark-setgoals); /* Light text */ }
        .meal-info div:last-child { color: var(--text-muted-setgoals); font-size: 0.85em; }
        .add-food-btn {
            background-color: #444; color: var(--text-muted-setgoals); margin-left: auto; border: 1px solid #555; padding: 5px 8px; font-size: 0.9rem; line-height: 1; border-radius: 50%; width: 28px; height: 28px; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0; cursor: pointer; transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .add-food-btn:hover { background-color: #555; color: var(--text-color); border-color: #666; }
        .calorie-summary {
            display: flex; flex-direction: column; gap: 10px;
            color: var(--text-muted-setgoals); font-size: 1em; margin-top: 1rem; padding-top: 1rem;
            border-top: 1px solid var(--border-color-light-setgoals);
        }
        .summary-item { display: flex; justify-content: space-between; align-items: center; }
        .summary-item span:last-child { font-weight: 600; color: var(--text-dark-setgoals); /* Light text */ }
        .summary-item span.exercise { color: #f44336; } /* Keep red */
        .summary-item.goal span:last-child { color: var(--primary-color-darkest-setgoals); font-size: 1.1em; font-weight: bold; }
        .summary-divider { border: none; height: 1px; background-color: var(--border-color-light-setgoals); margin: 5px 0; }
        .editable {
            cursor: pointer; border-bottom: 1px dashed var(--primary-color-darkest-setgoals); padding-bottom: 1px; transition: background-color 0.2s ease; display: inline-block;
            color: var(--text-dark-setgoals); /* Ensure editable text is light */
        }
        .editable:hover { background-color: rgba(255, 215, 0, 0.1); }
        .nutrient-header {
            display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 10px; padding: 0 10px 10px 10px; font-size: 0.85em; font-weight: 600; text-align: right; border-bottom: 1px solid var(--border-color-light-setgoals); margin-bottom: 10px; text-transform: uppercase;
            color: var(--primary-color-darkest-setgoals); /* Change header text to gold */
        }
        .nutrient-list { list-style: none; max-height: 400px; overflow-y: auto; padding-right: 5px; margin: 0; }
        .nutrient-list li { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 10px; padding: 10px; border-bottom: 1px solid #282828; align-items: center; font-size: 0.95em; }
        .nutrient-list li:last-child { border-bottom: none; }
        .nutrient-list li span:first-child { font-weight: 500; text-align: left; color: var(--text-dark-setgoals); /* Light text */ }
        .nutrient-list li span:not(:first-child) { text-align: right; color: var(--text-muted-setgoals); /* Muted light */ }
        .macros-legend { display: flex; flex-direction: column; gap: 1rem; }
        .legend-item {
            display: grid; grid-template-columns: auto 1fr auto auto; align-items: center; gap: 10px; font-size: 0.95em;
            color: var(--text-dark-setgoals); /* Light text */
            padding: 10px; background-color: var(--snd-bf-color); /* Darker bg */
            border-radius: 4px; border: 1px solid var(--border-color-light-setgoals); /* Dark border */
        }
        .color-square { width: 14px; height: 14px; display: inline-block; border-radius: 3px; border: 1px solid rgba(255,255,255,0.1); } /* Lighter border */

        /* Modal Dark Theme Styles */
        .modal { background-color: var(--modal-overlay-bg); }
        .modal-content {
            background-color: var(--modal-bg-setgoals); /* Dark modal bg */
            padding: 2rem; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); /* Darker shadow */
            width: 100%; max-width: 500px; position: relative; animation: slideInModal 0.3s ease-out; max-height: 90vh; overflow-y: auto;
            color: var(--modal-text-setgoals); /* Light modal text */
            border: 1px solid var(--border-color-light); /* Dark border */
        }
        .modal-close-btn {
            color: var(--text-muted-setgoals); /* Muted light */
        }
        .modal-close-btn:hover {
            color: var(--text-color); /* Brighter light */
        }
        #log-meal-modal h3 { margin-top: 0; margin-bottom: 1.5rem; text-align: center; border-bottom: 1px solid var(--border-color-light-setgoals); padding-bottom: 0.8rem; }
        #log-meal-modal h3 span { /* Color already set to gold via specific rule */
            font-weight: 500; font-size: 0.9em;
        }
        #log-meal-modal .edit-input-container label {
            display: block; font-size: 0.9rem; margin-bottom: 4px;
            color: var(--text-muted-setgoals); /* Muted light */
            font-weight: 500;
        }
        #log-meal-modal .edit-input-container input,
        #log-meal-modal .edit-input-container select {
            /* Styles inherited from general input rule */
        }
        #log-meal-modal .modal-actions { margin-top: 1.5rem; display: flex; justify-content: flex-end; gap: 10px; }
        #log-meal-save-button { /* Primary button style */
            background-color: var(--button-primary-bg); color: var(--button-primary-text); border: none; padding: 10px 18px; border-radius: 4px; font-weight: 600; cursor: pointer; transition: background-color 0.3s ease;
        }
        #log-meal-save-button:hover { background-color: var(--button-primary-hover-bg); }
        #log-meal-cancel-button { /* Secondary button style */
            background-color: var(--button-secondary-bg); color: var(--button-secondary-text); border: none; padding: 10px 18px; border-radius: 4px; font-weight: 600; cursor: pointer; transition: background-color 0.3s ease;
        }
        #log-meal-cancel-button:hover { background-color: var(--button-secondary-hover-bg); }
        #log-meal-modal .logged-items-display {
            margin-top: 1.5rem; text-align: left; max-height: 150px; overflow-y: auto;
            border: 1px solid var(--border-color-light-setgoals); border-radius: 4px; padding: 10px;
            background-color: var(--input-bg-setgoals); /* Dark bg */
        }
        #log-meal-modal .logged-items-display h4 { margin: 0 0 0.5rem 0; font-size: 1rem; border-bottom: 1px solid var(--border-color-light-setgoals); padding-bottom: 0.3rem; } /* Label color already gold */
        #log-meal-modal .logged-items-list { list-style: none; padding-left: 0; font-size: 0.9em; margin: 0; }
        #log-meal-modal .logged-items-list li { padding: 4px 0; border-bottom: 1px dashed var(--border-color-light-setgoals); display: flex; justify-content: space-between; gap: 8px; }
        #log-meal-modal .logged-items-list li:last-child { border-bottom: none; }
        #log-meal-modal .logged-items-list .item-name { font-weight: 500; flex-grow: 1; word-break: break-word; margin-right: 10px; }
        #log-meal-modal .logged-items-list .item-details { color: var(--text-muted-setgoals); font-size: 0.9em; white-space: nowrap; flex-shrink: 0; }
        #log-meal-modal .logged-items-list .remove-logged-item-btn {
            background: none; border: none; color: #f44336; /* Keep red */
            font-size: 1rem; line-height: 1; cursor: pointer;
            padding: 0 3px; margin-left: 5px; transition: color 0.2s ease;
            flex-shrink: 0;
        }
        #log-meal-modal .logged-items-list .remove-logged-item-btn:hover { color: #d32f2f; }
        #log-meal-modal .logged-items-list .no-items-logged { color: var(--text-muted-setgoals); font-style: italic; text-align: center; padding: 10px 0; border-bottom: none; display: block; }
        .validation-error { color: #f44336; font-size: 0.9em; margin-top: 5px; }


        /* Responsive Adjustments for Dark Theme */
        @media (max-width: 1024px) {
            /* Inherited styles should work, specific overrides if needed */
        }

        @media (max-width: 992px) {
             main.content-grid {
                 grid-template-columns: 1fr;
                 padding-top: calc(var(--header-height-mobile, 80px) + 1rem);
            }
             .calendar-widget { order: -1; margin-bottom: var(--grid-gap); }
        }
         @media (max-width: 767px) {
             main.content-grid {
                 padding-top: calc(var(--header-height-mobile, 80px) + 1rem);
             }
             .main-tab-button { font-size: 1.3rem; padding: 0.6rem 1rem; }
             .day-schedule li { background-color: var(--snd-bf-color); } /* Adjust nested background */
         }
         @media (max-width: 480px) {
              .activity-planner .activity-form { grid-template-columns: 1fr; }
              #weekly-plan-display { grid-template-columns: 1fr; }
              .main-tab-button { font-size: 1.2rem; padding: 0.5rem 0.8rem; gap: 0.5rem;}
              .main-tab-button i { font-size: 1.5rem; }
              .content-placeholder { padding: 1rem; }
              .modal-content { padding: 1.5rem; }
         }
    </style>
</head>
<body>

    <header>
        <a href="home.html" class="logo"><img src="../images/logo.png" alt="OptiLife Logo"></a>
        <div class='bx bx-menu' id="menu-icon"></div>
        <ul class="navbar">
             <div class="navbar-left">
                 <li><a href="home.html">Home</a></li>
                 <li><a href="setGoals.html" class="active">Set Goals</a></li>
                 <li><a href="progress.html">Track Progress</a></li>
                 <li><a href="membership.html">Membership</a></li>
             </div>
             <div class="navbar-right">
                 <li>
                     <img src="../images/user_pic.jpg" alt="User Profile" class="profile-pic">
                 </li>
                 <li>
                     <a href="signin.html" id="logout-link">Logout</a>
                 </li>
             </div>
        </ul>
    </header>

    <main class="content-grid">
        <div class="calendar-widget card">
            <h2>Select Date</h2>
            <div class="calendar-header">
                <button class="cal-nav prev" aria-label="Previous month"><</button>
                <span class="current-month-year">April 2025</span>
                <button class="cal-nav next" aria-label="Next month">></button>
            </div>
            <div class="calendar-grid">
                <!-- Calendar grid will be populated by JS -->
            </div>
            <div class="input-block"> <label for="startDate">Start Date</label> <input type="date" id="startDate" name="startDate" class="info-input" value="2025-01-15"> </div>
            <div class="input-block"> <label for="overallGoals">Overall Goals</label> <input type="text" id="overallGoals" name="overallGoals" class="info-input" placeholder="Enter your goals here..." value="Improved overall fitness, Increased muscle strength"> </div>
            <div class="input-block"> <label for="currentWeight">Current Weight (kg)</label> <input type="number" step="0.1" id="currentWeight" name="currentWeight" class="info-input" placeholder="e.g., 70.5" value="45"> </div>
            <div class="input-block"> <label for="goalWeight">Goal Weight (kg)</label> <input type="number" step="0.1" id="goalWeight" name="goalWeight" class="info-input" placeholder="e.g., 65.0" value="40"> </div>
            <div class="input-block"> <label for="weightLossGoal">Weekly Goal</label> <select id="weightLossGoal" name="weightLossGoal" class="info-input"> <option value="1">Lose 1 kg per week</option> <option value="0.75">Lose 0.75 kg per week</option> <option value="0.5" selected>Lose 0.5 kg per week</option> <option value="0.25">Lose 0.25 kg per week</option> <option value="0">Maintain current weight</option> <option value="-0.25">Gain 0.25 kg per week</option> <option value="-0.5">Gain 0.5 kg per week</option> </select> </div>
            <div class="input-block"> <label for="activity-level">Activity Level</label> <select id="activity-level" name="activity-level" class="info-input"> <option value="Not Very Active">Not Very Active</option> <option value="Lightly Active" selected>Lightly Active</option> <option value="Active">Active</option> <option value="Very Active">Very Active</option> </select> </div>
        </div>

         <div class="main-tab-content card">
            <nav class="main-content-tabs">
                <button class="main-tab-button active" data-target="#tabs-1">
                    <i class='bx bx-dumbbell'></i> Fitness Goals
                </button>
                <button class="main-tab-button" data-target="#tabs-3">
                    <i class='bx bx-restaurant'></i> Nutrition Goals
                </button>
            </nav>

            <div id="tabs-1" class="tab-content active">
                <div class="content-placeholder">
                    <h1>Set Your Fitness Goal</h1>
                    <div class="workout-schedule-container">
                        <section class="activity-planner card">
                             <h2>Plan Your Weekly Activities</h2>
                            <form id="activity-form" class="activity-form">
                                <div class="input-group"> <label for="activity-day">Day:</label> <select id="activity-day" name="activity-day"> <option value="Monday">Monday</option> <option value="Tuesday">Tuesday</option> <option value="Wednesday">Wednesday</option> <option value="Thursday">Thursday</option> <option value="Friday">Friday</option> <option value="Saturday">Saturday</option> <option value="Sunday">Sunday</option> </select> </div>
                                <div class="input-group"> <label for="activity-type">Workout Type:</label> <select id="activity-type" name="activity-type"> <option>Upper Body and Lower Body Split</option> <option>Full Body</option> <option>Core</option> <option>Push/Pull/Legs</option> <option>Circuit Training</option> <option>Cardio</option> <option>Weightlifting</option> <option>HIIT</option> <option>CrossFit</option> <option>Yoga</option> <option>Pilates</option> <option>Stretching</option> <option>Rest Day</option> </select> </div>
                                <div class="input-group"> <label for="activity-name">Activity:</label> <input type="text" id="activity-name" name="activityName" placeholder="e.g., Running, Bench Press"> </div>
                                <div class="input-group"> <label for="activity-reps">Reps:</label> <input type="text" id="activity-reps" name="activityReps" placeholder="e.g., 3-5, 8-12"> </div>
                                <div class="input-group"> <label for="activity-sets">Sets:</label> <input type="number" id="activity-sets" name="activitySets" placeholder="e.g., 3"> </div>
                                <div class="input-group"> <label for="activity-weight">Weight(lb):</label> <input type="number" step="0.5" id="activity-weight" name="activityWeight" placeholder="e.g., 50, 100"> </div>
                                <div class="input-group"> <label for="activity-duration">Duration:</label> <input type="text" id="activity-duration" name="activityDuration" placeholder="e.g., 30 min, 1 hr"> </div>
                                <button type="submit" id="add-activity-btn">Add Activity to Plan</button>
                            </form>
                            <h3>Weekly Schedule:</h3>
                            <div id="weekly-plan-display">
                                <div class="day-schedule"><h4>Monday</h4><ul data-day="Monday"></ul></div>
                                <div class="day-schedule"><h4>Tuesday</h4><ul data-day="Tuesday"></ul></div>
                                <div class="day-schedule"><h4>Wednesday</h4><ul data-day="Wednesday"></ul></div>
                                <div class="day-schedule"><h4>Thursday</h4><ul data-day="Thursday"></ul></div>
                                <div class="day-schedule"><h4>Friday</h4><ul data-day="Friday"></ul></div>
                                <div class="day-schedule"><h4>Saturday</h4><ul data-day="Saturday"></ul></div>
                                <div class="day-schedule"><h4>Sunday</h4><ul data-day="Sunday"></ul></div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>

            <div id="tabs-3" class="tab-content">
                 <div class="content-placeholder">
                    <h1>Nutrition Goals:</h1>
                    <nav class="tabs">
                        <button class="tab-button active" data-tab="calories">CALORIES</button>
                        <button class="tab-button" data-tab="nutrients">NUTRIENTS</button>
                        <button class="tab-button" data-tab="macros">MACROS</button>
                    </nav>

                    <div id="calories-content" class="nutrition-tab-content active">
                         <h2>Calories Breakdown</h2>
                        <div class="nutrition-details-full">
                            <div class="calories-breakdown">
                                <div class="meal-item">
                                    <span class="color-square" style="background-color: #bf9a33;"></span>
                                    <div class="meal-info">
                                        <div>Breakfast</div>
                                        <div data-value="breakfast-calories">0% (0 cal)</div>
                                    </div>
                                    <button class="btn btn-icon add-food-btn" data-meal-type="Breakfast" aria-label="Add food to Breakfast" title="Add Food">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="meal-item">
                                    <span class="color-square" style="background-color: #febd14;"></span>
                                    <div class="meal-info">
                                        <div>Lunch</div>
                                        <div data-value="lunch-calories">0% (0 cal)</div>
                                    </div>
                                     <button class="btn btn-icon add-food-btn" data-meal-type="Lunch" aria-label="Add food to Lunch" title="Add Food">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="meal-item">
                                    <span class="color-square" style="background-color: #fece43;"></span>
                                     <div class="meal-info">
                                       <div>Dinner</div>
                                       <div data-value="dinner-calories">0% (0 cal)</div>
                                     </div>
                                      <button class="btn btn-icon add-food-btn" data-meal-type="Dinner" aria-label="Add food to Dinner" title="Add Food">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="meal-item">
                                    <span class="color-square" style="background-color: #feda75;"></span>
                                     <div class="meal-info">
                                        <div>Snacks</div>
                                        <div data-value="snack-calories">0% (0 cal)</div>
                                     </div>
                                      <button class="btn btn-icon add-food-btn" data-meal-type="Snacks" aria-label="Add food to Snacks" title="Add Food">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="calorie-summary">
                                <div class="summary-item">
                                    <span>Total Calories Consumed</span>
                                    <span data-value="total-calories">0</span>
                                </div>
                                 <div class="summary-item">
                                    <span>Exercise Calories Burned</span>
                                    <span data-value="exercise-calories" class="exercise editable" data-editable="true" data-id="exercise-calories" data-type="number" data-unit="cal" data-label="Exercise Calories" title="Click to edit" data-goal-value="0">0 cal</span>
                                </div>
                                <div class="summary-item net-calories-item">
                                    <span>Net Calories</span>
                                    <span data-value="net-calories">0</span>
                                </div>
                                 <hr class="summary-divider">
                                <div class="summary-item goal">
                                    <span>Calorie Goal</span>
                                    <span data-value="goal-calories" class="editable" data-editable="true" data-id="calorie-goal" data-type="number" data-unit="cal" data-label="Calorie Goal" title="Click to edit" data-goal-value="1520">1520</span>
                                </div>
                                <div class="summary-item">
                                    <span>Calories Remaining</span>
                                    <span data-value="calories-remaining">1520</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="nutrients-content" class="nutrition-tab-content">
                         <h2>Nutrient Details</h2>
                        <div class="nutrient-header">
                            <span>Nutrient</span>
                            <span>Total</span>
                            <span>Goal</span>
                            <span>Left</span>
                        </div>
                           <ul class="nutrient-list">
                               <li data-nutrient="protein">
                                   <span>Protein</span>
                                   <span data-value="protein-total">0 g</span>
                                   <span class="editable" data-editable="true" data-id="protein-goal" data-type="number" data-unit="g" data-label="Protein Goal" title="Click to edit" data-goal-value="76">76 g</span>
                                   <span data-value="protein-left">76 g</span>
                               </li>
                               <li data-nutrient="carbohydrates">
                                   <span>Carbohydrates</span>
                                   <span data-value="carbs-total">0 g</span>
                                   <span class="editable" data-editable="true" data-id="carbs-goal" data-type="number" data-unit="g" data-label="Carbohydrates Goal" title="Click to edit" data-goal-value="190">190 g</span>
                                   <span data-value="carbs-left">190 g</span>
                               </li>
                               <li data-nutrient="fiber">
                                   <span>Fiber</span>
                                   <span data-value="fiber-total">0 g</span>
                                   <span class="editable" data-editable="true" data-id="fiber-goal" data-type="number" data-unit="g" data-label="Fiber Goal" title="Click to edit" data-goal-value="25">25 g</span>
                                   <span data-value="fiber-left">25 g</span>
                               </li>
                               <li data-nutrient="sugar">
                                   <span>Sugar</span>
                                   <span data-value="sugar-total">0 g</span>
                                   <span class="editable" data-editable="true" data-id="sugar-goal" data-type="number" data-unit="g" data-label="Sugar Goal" title="Click to edit" data-goal-value="57">57 g</span>
                                   <span data-value="sugar-left">57 g</span>
                               </li>
                                <li data-nutrient="fat">
                                   <span>Fat</span>
                                   <span data-value="fat-total">0 g</span>
                                   <span class="editable" data-editable="true" data-id="fat-goal" data-type="number" data-unit="g" data-label="Fat Goal" title="Click to edit" data-goal-value="51">51 g</span>
                                   <span data-value="fat-left">51 g</span>
                               </li>
                               <li data-nutrient="saturated_fat">
                                   <span>Saturated Fat</span>
                                   <span data-value="satfat-total">0 g</span>
                                   <span class="editable" data-editable="true" data-id="satfat-goal" data-type="number" data-unit="g" data-label="Saturated Fat Goal" title="Click to edit" data-goal-value="17">17 g</span>
                                   <span data-value="satfat-left">17 g</span>
                               </li>
                                <li data-nutrient="polyunsaturated_fat">
                                   <span>Polyunsaturated Fat</span>
                                   <span data-value="polyfat-total">0 g</span>
                                   <span class="editable" data-editable="true" data-id="polyfat-goal" data-type="number" data-unit="g" data-label="Polyunsaturated Fat Goal" title="Click to edit" data-goal-value="0">0 g</span>
                                   <span data-value="polyfat-left">0 g</span>
                               </li>
                               <li data-nutrient="monounsaturated_fat">
                                   <span>Monounsaturated Fat</span>
                                   <span data-value="monofat-total">0 g</span>
                                   <span class="editable" data-editable="true" data-id="monofat-goal" data-type="number" data-unit="g" data-label="Monounsaturated Fat Goal" title="Click to edit" data-goal-value="0">0 g</span>
                                   <span data-value="monofat-left">0 g</span>
                               </li>
                                <li data-nutrient="trans_fat">
                                   <span>Trans Fat</span>
                                   <span data-value="transfat-total">0 g</span>
                                   <span class="editable" data-editable="true" data-id="transfat-goal" data-type="number" data-unit="g" data-label="Trans Fat Goal" title="Click to edit" data-goal-value="0">0 g</span>
                                   <span data-value="transfat-left">0 g</span>
                               </li>
                                <li data-nutrient="cholesterol">
                                   <span>Cholesterol</span>
                                   <span data-value="cholesterol-total">0 mg</span>
                                   <span class="editable" data-editable="true" data-id="cholesterol-goal" data-type="number" data-unit="mg" data-label="Cholesterol Goal" title="Click to edit" data-goal-value="300">300 mg</span>
                                   <span data-value="cholesterol-left">300 mg</span>
                               </li>
                               <li data-nutrient="sodium">
                                   <span>Sodium</span>
                                   <span data-value="sodium-total">0 mg</span>
                                   <span class="editable" data-editable="true" data-id="sodium-goal" data-type="number" data-unit="mg" data-label="Sodium Goal" title="Click to edit" data-goal-value="2300">2,300 mg</span>
                                   <span data-value="sodium-left">2,300 mg</span>
                               </li>
                                <li data-nutrient="potassium">
                                   <span>Potassium</span>
                                   <span data-value="potassium-total">0 mg</span>
                                   <span class="editable" data-editable="true" data-id="potassium-goal" data-type="number" data-unit="mg" data-label="Potassium Goal" title="Click to edit" data-goal-value="3500">3,500 mg</span>
                                   <span data-value="potassium-left">3,500 mg</span>
                               </li>
                               <li data-nutrient="vitamin_a">
                                   <span>Vitamin A</span>
                                   <span data-value="vita-total">0 %</span>
                                   <span class="editable" data-editable="true" data-id="vita-goal" data-type="number" data-unit="%" data-label="Vitamin A Goal" title="Click to edit" data-goal-value="100">100 %</span>
                                   <span data-value="vita-left">100 %</span>
                               </li>
                               <li data-nutrient="vitamin_c">
                                   <span>Vitamin C</span>
                                   <span data-value="vitc-total">0 %</span>
                                   <span class="editable" data-editable="true" data-id="vitc-goal" data-type="number" data-unit="%" data-label="Vitamin C Goal" title="Click to edit" data-goal-value="100">100 %</span>
                                   <span data-value="vitc-left">100 %</span>
                               </li>
                                <li data-nutrient="calcium">
                                   <span>Calcium</span>
                                   <span data-value="calcium-total">0 %</span>
                                   <span class="editable" data-editable="true" data-id="calcium-goal" data-type="number" data-unit="%" data-label="Calcium Goal" title="Click to edit" data-goal-value="100">100 %</span>
                                   <span data-value="calcium-left">100 %</span>
                               </li>
                                <li data-nutrient="iron">
                                   <span>Iron</span>
                                   <span data-value="iron-total">0 %</span>
                                   <span class="editable" data-editable="true" data-id="iron-goal" data-type="number" data-unit="%" data-label="Iron Goal" title="Click to edit" data-goal-value="100">100 %</span>
                                   <span data-value="iron-left">100 %</span>
                               </li>
                           </ul>
                    </div>

                    <div id="macros-content" class="nutrition-tab-content">
                         <h2>Macronutrient Ratio</h2>
                         <p style="text-align: center; color: var(--text-muted-setgoals);"><em >Goals should total 100%</em></p>
                         <div class="nutrition-details-full">
                            <div class="macros-legend">
                                 <div class="legend-item" data-macro="carbs">
                                    <span class="color-square" style="background-color: #febd14;"></span>
                                    <span>Carbohydrates (<span data-value="macro-carbs-g">0g</span>)</span>
                                    <span class="percentage" data-value="macro-carbs-perc">0%</span>
                                    <span class="editable" data-editable="true" data-id="carbs-goal-perc" data-type="number" data-unit="%" data-label="Carbohydrates Goal %" title="Click to edit" data-goal-value="50">50%</span>
                                </div>
                                 <div class="legend-item" data-macro="fat">
                                    <span class="color-square" style="background-color: #fece43;"></span>
                                    <span>Fat (<span data-value="macro-fat-g">0g</span>)</span>
                                    <span class="percentage" data-value="macro-fat-perc">0%</span>
                                    <span class="editable" data-editable="true" data-id="fats-goal-perc" data-type="number" data-unit="%" data-label="Fat Goal %" title="Click to edit" data-goal-value="30">30%</span>
                                </div>
                                 <div class="legend-item" data-macro="protein">
                                    <span class="color-square" style="background-color: #feda75;"></span>
                                    <span>Protein (<span data-value="macro-protein-g">0g</span>)</span>
                                    <span class="percentage" data-value="macro-protein-perc">0%</span>
                                    <span class="editable" data-editable="true" data-id="protein-goal-perc" data-type="number" data-unit="%" data-label="Protein Goal %" title="Click to edit" data-goal-value="20">20%</span>
                                </div>
                            </div>
                            <p id="macro-goal-warning" class="validation-error" style="text-align: center; margin-top: 1rem; display: none;"></p>
                         </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

     <!-- Log Meal Modal -->
     <div class="modal" id="log-meal-modal" role="dialog" aria-labelledby="log-meal-title" aria-modal="true">
        <div class="modal-content card">
            <button class="modal-close-btn" aria-label="Close modal">Ã—</button>
            <h3 id="log-meal-title">Log Food Item for <span id="log-meal-modal-date">Date</span></h3>
            <form id="log-meal-form">
                <input type="hidden" id="log-meal-date-hidden" name="logDate">
                 <div class="edit-input-container"> <label for="log-meal-type">Meal Type:</label> <select id="log-meal-type" name="mealType" required> <option value="Breakfast">Breakfast</option> <option value="Lunch">Lunch</option> <option value="Dinner">Dinner</option> <option value="Snacks">Snacks</option> </select> </div>
                 <div class="edit-input-container"> <label for="log-food-name">Food Name:</label> <input type="text" id="log-food-name" name="foodName" required placeholder="e.g., Apple, medium"> </div>
                 <div class="edit-input-container"> <label for="log-calories">Calories (kcal):</label> <input type="number" id="log-calories" name="calories" required min="0" step="1" placeholder="e.g., 95"> </div>
                 <div class="edit-input-container"> <label for="log-protein">Protein (g):</label> <input type="number" id="log-protein" name="protein" min="0" step="0.1" placeholder="e.g., 0.5" value="0"> </div>
                 <div class="edit-input-container"> <label for="log-carbs">Carbs (g):</label> <input type="number" id="log-carbs" name="carbs" min="0" step="0.1" placeholder="e.g., 25" value="0"> </div>
                 <div class="edit-input-container"> <label for="log-fat">Fat (g):</label> <input type="number" id="log-fat" name="fat" min="0" step="0.1" placeholder="e.g., 0.3" value="0"> </div>
                 <p id="log-meal-validation-error" class="validation-error" style="display: none;"></p>
                <div class="modal-actions">
                    <button type="submit" id="log-meal-save-button">Log Item</button>
                    <button type="button" class="modal-close-btn" id="log-meal-cancel-button" style="margin-bottom: 20px; width: 80px; height:60; font-size: 1rem;">Cancel</button>
                </div>
            </form>
            <div class="logged-items-display">
                 <h4>Logged Today (<span id="logged-items-date-display">Date</span>):</h4>
                 <ul id="logged-items-list">
                     <li class="no-items-logged">No items logged yet for this date.</li>
                 </ul>
             </div>
        </div>
    </div>
    <!-- End Log Meal Modal -->

    <!-- Logout Confirmation Modal -->
    <div id="logoutConfirmationModal" class="modal">
        <div class="modal-content">
            <button id="closeLogoutModalButton" class="modal-close-btn" aria-label="Close modal">Ã—</button>
            <p id="logoutModalMessage" style="font-size: 1.5rem;">Are you sure you want to logout?</p>
            <div style="text-align: center; margin-top: 1.5rem;">
                 <button id="cancelLogoutButton" class="btn-secondary" style="margin-right: 20px;">Cancel</button>
                 <button id="okLogoutButton" class="btn-primary">Logout</button>
            </div>
        </div>
    </div>
    <!-- End Logout Modal -->

    <!-- Generic Alert Modal -->
    <div id="alertModal" class="modal">
        <div class="modal-content">
            <button id="closeAlertModalButton" class="modal-close-btn" aria-label="Close modal">Ã—</button>
            <p id="alertModalMessage" style="font-size: 1.5rem;">Alert Message Goes Here</p>
            <div style="text-align: center; margin-top: 1.5rem;">
                 <button id="alertModalOkButton" class="btn-primary">OK</button>
            </div>
        </div>
    </div>
    <!-- End Alert Modal -->

     <section id="subscribe" class="subscribe-section">
        <div class="container subscribe-content">
             <div class="subscribe-text">
                <h2>Subscribe</h2>
                <p>Join our fitness family and get tips, exclusive updates, and special offers. Start your journey today!</p>
                <form class="subscribe-form">
                    <input type="email" placeholder="Email" required>
                    <button type="submit" class="btn btn-primary">Send</button>
                </form>
                <div class="social-icons">
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
                    <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            <div class="footer-links">
                 <div><h4>Company</h4><ul><li><a href="#">Press</a></li><li><a href="#">Blog</a></li><li><a href="#">About</a></li><li><a href="#">Careers</a></li></ul></div> <div><h4>Services</h4><ul><li><a href="#">Training</a></li><li><a href="#">Nutrition</a></li><li><a href="#">Lifestyles</a></li></ul></div> <div><h4>Legal</h4><ul><li><a href="#">Policy</a></li><li><a href="#">Privacy & Cookies</a></li><li><a href="#">Terms & Conditions</a></li></ul></div> <div><h4>Community</h4><ul><li><a href="#">Contact</a></li><li><a href="#">Find a club</a></li><li><a href="#">Membership</a></li></ul></div> <div><h4>Gym</h4><ul><li><a href="#">Book a Gym</a></li><li><a href="#">Find a Gym</a></li></ul></div>
            </div>
        </div>
    </section>
    <footer>
        <div class="container">
            <p>Â© 2024 OPTILIFE. All Rights Reserved.</p>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <!-- Removed chart.js script -->
    <!-- Removed chartjs-adapter-moment script -->
    <!-- <script src="progress.js"></script> -->

    <script>
      $(document).ready(function() {
          // --- Cache jQuery Selectors ---
          const $menuIcon = $('#menu-icon');
          const $navbar = $('.navbar');
          const $logoutLink = $('#logout-link');
          const $logoutModal = $('#logoutConfirmationModal');
          const $closeLogoutModalBtn = $('#closeLogoutModalButton');
          const $cancelLogoutBtn = $('#cancelLogoutButton');
          const $okLogoutBtn = $('#okLogoutButton');
          const $alertModal = $('#alertModal');
          const $alertModalMessage = $('#alertModalMessage');
          const $closeAlertModalBtn = $('#closeAlertModalButton');
          const $alertModalOkBtn = $('#alertModalOkButton');

          const $calendarGrid = $('.calendar-grid');
          const $currentMonthYear = $('.current-month-year');
          const $logMealModal = $('#log-meal-modal');
          const $logMealForm = $('#log-meal-form');
          const $logMealModalDate = $('#log-meal-modal-date');
          const $logMealDateHidden = $('#log-meal-date-hidden');
          const $logMealTypeSelect = $('#log-meal-type');
          const $loggedItemsList = $('#logged-items-list');
          const $loggedItemsDateDisplay = $('#logged-items-date-display');
          const $logMealValidationError = $('#log-meal-validation-error');
          const $activityForm = $('#activity-form');
          const $weeklyPlanDisplay = $('#weekly-plan-display');

          // --- Global State ---
          let selectedDate = moment().format('YYYY-MM-DD'); // Initialize with today's date
          let currentMonthMoment = moment(selectedDate);
          const foodLog = {}; // Store logged food { 'YYYY-MM-DD': [item1, item2] }
          const activityLog = {}; // Store planned activities { 'DayName': [activity1] }

          // --- Header Menu Logic ---
          if ($menuIcon.length && $navbar.length) {
              $menuIcon.on('click', function() {
                  $(this).toggleClass('bx-x');
                  $navbar.toggleClass('active');
              });

              $navbar.on('click', 'a, .profile-pic', function(event) {
                   if ($navbar.hasClass('active') && !$(this).is('#logout-link')) {
                       $navbar.removeClass('active');
                       $menuIcon.removeClass('bx-x');
                   }
              });

              $(window).on('scroll', function() {
                  if ($navbar.hasClass('active')) {
                      $navbar.removeClass('active');
                      $menuIcon.removeClass('bx-x');
                  }
              });
          } else {
              console.warn("Header menu icon or navbar not found.");
          }

          // --- Modal Handling ---

          // Generic Alert Modal
          function showAlertModal(message) {
              $alertModalMessage.text(message);
              $alertModal.addClass('active');
          }
          function closeAlertModal() {
              $alertModal.removeClass('active');
          }
          $alertModal.on('click', '.modal-close-btn, #alertModalOkButton', closeAlertModal);

          // Logout Modal
          if ($logoutLink.length && $logoutModal.length) {
                $logoutLink.on('click', function(event) {
                    event.preventDefault();
                    $logoutModal.addClass('active');
                });
                $logoutModal.on('click', '.modal-close-btn, #cancelLogoutButton', function() {
                     $logoutModal.removeClass('active');
                });
                $okLogoutBtn.on('click', function() {
                    $logoutModal.removeClass('active');
                    window.location.href = $logoutLink.attr('href');
                });
            } else {
                 console.warn("Logout link or modal not found.");
                 $logoutLink.on('click', function(event) {
                      event.preventDefault();
                       alert("Logout functionality error: Modal not found.");
                 });
            }


          // Log Meal Modal
          function openLogMealModal(event) {
              const mealType = $(event.currentTarget).data('meal-type');
              $logMealTypeSelect.val(mealType);
              $logMealModalDate.text(moment(selectedDate).format('MMMM D, YYYY'));
              $logMealDateHidden.val(selectedDate);
              $loggedItemsDateDisplay.text(moment(selectedDate).format('MMMM D'));
              $logMealValidationError.hide().text('');
              displayLoggedItemsForDate(selectedDate);
              $logMealModal.addClass('active');
              $logMealForm[0].reset();
              $('#log-meal-type').val(mealType);
              $('#log-food-name').focus();
          }

          function closeLogMealModal() {
              $logMealModal.removeClass('active');
              $logMealForm[0].reset();
              $logMealValidationError.hide().text('');
          }

          $('.add-food-btn').on('click', openLogMealModal);
          $logMealModal.on('click', '.modal-close-btn, #log-meal-cancel-button', closeLogMealModal);
          $logMealForm.on('submit', handleLogMealSubmit);
          $loggedItemsList.on('click', '.remove-logged-item-btn', removeLoggedItem);


          // --- Tab Switching Logic ---
          $('.main-tab-button').on('click', function() {
              const targetSelector = $(this).data('target');
              const $targetContent = $(targetSelector);

              if ($targetContent.length) {
                  $('.main-tab-button').removeClass('active');
                  $(this).addClass('active');
                  $('.main-tab-content .tab-content').removeClass('active');
                  $targetContent.addClass('active');
              } else {
                  console.warn("Main tab target content not found:", targetSelector);
              }
          });

           $('.tabs .tab-button').on('click', function() {
                const tabId = $(this).data('tab');
                const $container = $(this).closest('.content-placeholder');

                $container.find('.tabs .tab-button').removeClass('active');
                $(this).addClass('active');

                $container.find('.nutrition-tab-content').removeClass('active');
                $container.find('#' + tabId + '-content').addClass('active');
           });


          // --- Calendar Logic ---
          function renderCalendar(dateMoment) {
              $calendarGrid.empty();
              $currentMonthYear.text(dateMoment.format('MMMM YYYY'));

              const dayNames = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
              dayNames.forEach(day => $calendarGrid.append(`<div class="day-name">${day}</div>`));

              const startOfMonth = dateMoment.clone().startOf('month');
              const endOfMonth = dateMoment.clone().endOf('month');
              const startDayOfWeek = startOfMonth.day();

              for (let i = 0; i < startDayOfWeek; i++) {
                  $calendarGrid.append('<div class="date-cell empty"></div>');
              }

              let day = startOfMonth.clone();
              while (day.isSameOrBefore(endOfMonth, 'day')) {
                  const dateStr = day.format('YYYY-MM-DD');
                  const $cell = $('<div class="date-cell"></div>');
                  const $button = $(`<button data-date="${dateStr}">${day.date()}</button>`);

                  if (dateStr === selectedDate) {
                      $button.addClass('selected');
                  }
                  // Optional: Disable future dates
                  // if (day.isAfter(moment(), 'day')) {
                  //    $button.prop('disabled', true);
                  // }

                  $cell.append($button);
                  $calendarGrid.append($cell);
                  day.add(1, 'day');
              }
                const totalCells = startDayOfWeek + endOfMonth.date();
                const remainingCells = 7 - (totalCells % 7);
                if (remainingCells < 7) {
                    for (let i = 0; i < remainingCells; i++) {
                         $calendarGrid.append('<div class="date-cell empty"></div>');
                    }
                }
          }

          function updateSelectedDate(newDate) {
              selectedDate = newDate;
              $('.calendar-grid .date-cell button.selected').removeClass('selected');
              $(`.calendar-grid .date-cell button[data-date="${selectedDate}"]`).addClass('selected');
              $logMealModalDate.text(moment(selectedDate).format('MMMM D, YYYY'));
              $logMealDateHidden.val(selectedDate);
              $loggedItemsDateDisplay.text(moment(selectedDate).format('MMMM D'));
              displayLoggedItemsForDate(selectedDate);
              updateNutritionDisplay();
          }

          $('.cal-nav.prev').on('click', () => {
              currentMonthMoment.subtract(1, 'month');
              renderCalendar(currentMonthMoment);
          });
          $('.cal-nav.next').on('click', () => {
              currentMonthMoment.add(1, 'month');
              renderCalendar(currentMonthMoment);
          });
          $calendarGrid.on('click', '.date-cell button:not(:disabled)', function() {
              const newDate = $(this).data('date');
              updateSelectedDate(newDate);
          });


          // --- Fitness Plan Logic ---
          function addActivityToPlan(event) {
                event.preventDefault();

                const day = $('#activity-day').val();
                const type = $('#activity-type').val();
                const name = $('#activity-name').val().trim();
                const reps = $('#activity-reps').val().trim();
                const sets = $('#activity-sets').val().trim();
                const weight = $('#activity-weight').val().trim();
                const duration = $('#activity-duration').val().trim();

                if (!day || (!name && type !== 'Rest Day')) {
                    showAlertModal('Please select a day and enter an activity name (unless selecting Rest Day).');
                    return;
                }

                let displayText = `<strong>${type}:</strong> ${name || ''}`;
                const details = [];
                if (reps) details.push(`Reps: ${reps}`);
                if (sets) details.push(`Sets: ${sets}`);
                if (weight) details.push(`Weight: ${weight}lb`);
                if (duration) details.push(`Duration: ${duration}`);

                if (details.length > 0) {
                    displayText += ` (${details.join(', ')})`;
                }

                const $dayList = $weeklyPlanDisplay.find(`ul[data-day="${day}"]`);
                const $listItem = $(`<li>${displayText}<button class="remove-activity-btn" title="Remove Activity"><i class="fas fa-times"></i></button></li>`);

                $dayList.find('.no-activities').remove();
                $dayList.append($listItem);

                if (!activityLog[day]) {
                    activityLog[day] = [];
                }
                activityLog[day].push({ type, name, reps, sets, weight, duration });

                $('#activity-name, #activity-reps, #activity-sets, #activity-weight, #activity-duration').val('');
                $('#activity-type').prop('selectedIndex',0);
            }

            function removeActivityFromPlan(event) {
                 const $listItem = $(event.target).closest('li');
                 const $dayList = $listItem.closest('ul');
                 const day = $dayList.data('day');
                 const itemIndex = $listItem.index();

                 if (activityLog[day] && activityLog[day][itemIndex] !== undefined) {
                     activityLog[day].splice(itemIndex, 1);
                 }

                 $listItem.remove();
            }

          $activityForm.on('submit', addActivityToPlan);
          $weeklyPlanDisplay.on('click', '.remove-activity-btn', removeActivityFromPlan);


          // --- Nutrition Logging & Display Logic ---
          function displayLoggedItemsForDate(dateStr) {
              $loggedItemsList.empty();
              const items = foodLog[dateStr] || [];

              if (items.length === 0) {
                  $loggedItemsList.append('<li class="no-items-logged">No items logged yet for this date.</li>');
              } else {
                  items.forEach((item, index) => {
                      const listItem = `
                          <li>
                              <span class="item-details">[${item.mealType}]</span>
                              <span class="item-name">${item.foodName}</span>
                              <span class="item-details">${item.calories} kcal</span>
                              <button class="remove-logged-item-btn" data-index="${index}" title="Remove Item">
                                  <i class="fas fa-times"></i>
                              </button>
                          </li>`;
                      $loggedItemsList.append(listItem);
                  });
              }
          }

          function removeLoggedItem(event) {
             const $button = $(event.target).closest('.remove-logged-item-btn');
             const indexToRemove = $button.data('index');
             const dateStr = selectedDate;

             if (foodLog[dateStr] && foodLog[dateStr][indexToRemove] !== undefined) {
                 foodLog[dateStr].splice(indexToRemove, 1);
                 displayLoggedItemsForDate(dateStr);
                 updateNutritionDisplay();
             } else {
                 console.warn("Could not find item to remove at index:", indexToRemove, "for date:", dateStr);
             }
          }

          function handleLogMealSubmit(event) {
              event.preventDefault();
              $logMealValidationError.hide().text('');

              const foodName = $('#log-food-name').val().trim();
              const calories = $('#log-calories').val();

              if (!foodName) {
                  $logMealValidationError.text('Food Name is required.').show();
                  return;
              }
              if (calories === '' || isNaN(calories) || parseFloat(calories) < 0) {
                  $logMealValidationError.text('Valid Calories (0 or more) are required.').show();
                  return;
              }

              const newItem = {
                  id: Date.now(),
                  date: selectedDate,
                  mealType: $logMealTypeSelect.val(),
                  foodName: foodName,
                  calories: parseFloat(calories),
                  protein: parseFloat($('#log-protein').val()) || 0,
                  carbs: parseFloat($('#log-carbs').val()) || 0,
                  fat: parseFloat($('#log-fat').val()) || 0,
              };

              if (!foodLog[selectedDate]) {
                  foodLog[selectedDate] = [];
              }
              foodLog[selectedDate].push(newItem);

              displayLoggedItemsForDate(selectedDate);
              updateNutritionDisplay();

              $('#log-food-name, #log-calories, #log-protein, #log-carbs, #log-fat').val('');
              $('#log-protein, #log-carbs, #log-fat').val('0');
              $('#log-food-name').focus();
          }

          function updateNutritionDisplay() {
              const itemsToday = foodLog[selectedDate] || [];
              let totals = { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0, sugar: 0, satfat: 0, polyfat: 0, monofat: 0, transfat: 0, cholesterol: 0, sodium: 0, potassium: 0, vita: 0, vitc: 0, calcium: 0, iron: 0 };
              let mealTotals = { Breakfast: 0, Lunch: 0, Dinner: 0, Snacks: 0 };

              itemsToday.forEach(item => {
                  totals.calories += item.calories || 0;
                  totals.protein += item.protein || 0;
                  totals.carbs += item.carbs || 0;
                  totals.fat += item.fat || 0;
                  totals.fiber += item.fiber || 0;
                  totals.sugar += item.sugar || 0;
                  totals.satfat += item.satfat || 0;
                  totals.polyfat += item.polyfat || 0;
                  totals.monofat += item.monofat || 0;
                  totals.transfat += item.transfat || 0;
                  totals.cholesterol += item.cholesterol || 0;
                  totals.sodium += item.sodium || 0;
                  totals.potassium += item.potassium || 0;
                  totals.vita += item.vita || 0;
                  totals.vitc += item.vitc || 0;
                  totals.calcium += item.calcium || 0;
                  totals.iron += item.iron || 0;

                  if (mealTotals.hasOwnProperty(item.mealType)) {
                      mealTotals[item.mealType] += item.calories || 0;
                  }
              });

              const totalCaloriesConsumed = totals.calories;
              $('[data-value="total-calories"]').text(Math.round(totalCaloriesConsumed));

              Object.keys(mealTotals).forEach(meal => {
                  const mealCal = mealTotals[meal];
                  const percentage = totalCaloriesConsumed > 0 ? Math.round((mealCal / totalCaloriesConsumed) * 100) : 0;
                  const key = meal.toLowerCase();
                  $(`[data-value="${key}-calories"]`).text(`${percentage}% (${Math.round(mealCal)} cal)`);
              });

              const goalCalories = parseFloat($('[data-value="goal-calories"]').attr('data-goal-value')) || 0;
              const exerciseCalories = parseFloat($('[data-value="exercise-calories"]').attr('data-goal-value')) || 0;

              const netCalories = Math.round(totalCaloriesConsumed - exerciseCalories);
              const caloriesRemaining = Math.round(goalCalories - netCalories);

              $('[data-value="net-calories"]').text(netCalories.toLocaleString());
              $('[data-value="calories-remaining"]').text(caloriesRemaining.toLocaleString());
              $('[data-value="exercise-calories"]').text(`${exerciseCalories.toLocaleString()} cal`);
              $('[data-value="goal-calories"]').text(`${goalCalories.toLocaleString()}`);


               $('.nutrient-list li').each(function() {
                  const $li = $(this);
                  const nutrientKey = $li.data('nutrient');
                  let totalKey = nutrientKey.replace(/_(\w)/g, (match, p1) => p1.toUpperCase()); // Convert snake_case to camelCase for totals object if needed
                  if (totalKey === 'carbohydrates') totalKey = 'carbs'; // specific mapping

                  const totalValue = totals[totalKey] || 0;
                  const $goalSpan = $li.find('.editable[data-id$="-goal"]');
                  const unit = $goalSpan.data('unit') || 'g';
                  const goalValue = parseFloat($goalSpan.attr('data-goal-value')) || 0;
                  const leftValue = Math.max(0, goalValue - totalValue);

                  const decimals = (unit === 'g' && totalValue < 10 && totalValue !== 0 && !Number.isInteger(totalValue)) ? 1 : 0;
                  const goalDecimals = (unit === '%') ? 0 : 0;
                  const leftDecimals = decimals;

                  $li.find(`[data-value="${totalKey}-total"], [data-value="${nutrientKey}-total"]`).text(`${totalValue.toFixed(decimals)}${unit ? ' ' + unit : ''}`);
                  $goalSpan.text(`${goalValue.toLocaleString(undefined, {maximumFractionDigits: goalDecimals})}${unit ? ' ' + unit : ''}`);
                  $li.find(`[data-value="${totalKey}-left"], [data-value="${nutrientKey}-left"]`).text(`${leftValue.toFixed(leftDecimals)}${unit ? ' ' + unit : ''}`);
               });

              const totalMacroCalories = (totals.protein * 4) + (totals.carbs * 4) + (totals.fat * 9);
              const proteinPerc = totalMacroCalories > 0 ? Math.round((totals.protein * 4 / totalMacroCalories) * 100) : 0;
              const carbsPerc = totalMacroCalories > 0 ? Math.round((totals.carbs * 4 / totalMacroCalories) * 100) : 0;
              const fatPerc = totalMacroCalories > 0 ? Math.max(0, 100 - proteinPerc - carbsPerc) : 0;

              $('[data-value="macro-protein-g"]').text(totals.protein.toFixed(1) + 'g');
              $('[data-value="macro-carbs-g"]').text(totals.carbs.toFixed(1) + 'g');
              $('[data-value="macro-fat-g"]').text(totals.fat.toFixed(1) + 'g');

              $('[data-value="macro-protein-perc"]').text(proteinPerc + '%');
              $('[data-value="macro-carbs-perc"]').text(carbsPerc + '%');
              $('[data-value="macro-fat-perc"]').text(fatPerc + '%');

              checkMacroGoalTotal();
          }

          function handleEditableClick(event) {
                const $target = $(event.currentTarget);
                const originalValueText = $target.text();
                const currentValue = $target.attr('data-goal-value') || originalValueText.replace(/[^0-9.]/g, '');
                const label = $target.data('label') || 'value';
                const unit = $target.data('unit') || '';

                const newValue = prompt(`Enter new ${label}:`, currentValue);

                if (newValue !== null) {
                    const parsedValue = parseFloat(newValue);
                    if (!isNaN(parsedValue) && parsedValue >= 0) {
                         const formattedValue = parsedValue;
                         $target.attr('data-goal-value', formattedValue);

                         let displayText;
                         if (unit === '%') {
                            displayText = `${formattedValue.toFixed(0)}${unit}`;
                         } else if (unit === 'cal' || unit === 'mg') {
                            displayText = `${formattedValue.toLocaleString(undefined, {maximumFractionDigits: 0})}${unit ? ' ' + unit : ''}`;
                         } else {
                             displayText = `${formattedValue.toLocaleString(undefined, {maximumFractionDigits: 1})}${unit ? ' ' + unit : ''}`;
                         }
                         $target.text(displayText);

                         if ($target.data('id').includes('-goal')) {
                             updateNutritionDisplay();
                         }
                          if ($target.data('id') === 'exercise-calories') {
                              updateNutritionDisplay();
                          }
                          if ($target.data('id').includes('-goal-perc')) {
                              checkMacroGoalTotal();
                              updateNutritionDisplay(); // Also update totals based on new macro goals if logic depends on it
                          }
                    } else {
                         showAlertModal('Invalid input. Please enter a non-negative number.');
                         $target.text(originalValueText);
                    }
                }
           }

            function checkMacroGoalTotal() {
                let totalPerc = 0;
                $('.macros-legend .editable[data-id$="-goal-perc"]').each(function() {
                    totalPerc += parseFloat($(this).attr('data-goal-value')) || 0;
                });
                 const $macroWarning = $('#macro-goal-warning');
                 if ($macroWarning.length) {
                     if (Math.round(totalPerc) !== 100) {
                        $macroWarning.text(`Warning: Macro goals sum to ${totalPerc.toFixed(0)}%, should be 100%.`).show();
                     } else {
                        $macroWarning.hide();
                     }
                 }
                 // Update display of goal percentages after edit/check
                 $('.macros-legend .editable[data-id$="-goal-perc"]').each(function() {
                     const $el = $(this);
                     const goalVal = parseFloat($el.attr('data-goal-value')) || 0;
                     $el.text(`${goalVal.toFixed(0)}%`);
                 });
            }

          $('.main-tab-content').on('click', '.editable[data-editable="true"]', handleEditableClick);

          // --- Initial Setup ---
          renderCalendar(currentMonthMoment);
          updateSelectedDate(selectedDate);
          checkMacroGoalTotal();

      }); // End document ready
    </script>

</body>
</html>